# ============================================
# Bayit+ Backend Configuration
# ============================================
# This file documents all configuration options.
# Copy to .env and fill in your values.
#
# REQUIRED fields are marked with [REQUIRED] - server will fail without them
# OPTIONAL fields are marked with [OPTIONAL] - features may be limited without them
# ============================================

# ============================================
# SECURITY (CRITICAL)
# ============================================

# [REQUIRED] Secret key for JWT token signing
# SECURITY WARNING: Must be at least 32 characters of cryptographically random data
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
# NEVER use default values, NEVER commit real keys to version control
SECRET_KEY=YOUR_SECRET_KEY_HERE_MINIMUM_32_CHARS

# [REQUIRED] Debug mode - MUST be false in production
# When true: enables detailed error messages, allows localhost CORS
# When false: requires all configuration to be explicitly set
DEBUG=false

# ============================================
# DATABASE (CRITICAL)
# ============================================

# [REQUIRED] MongoDB connection string
# For MongoDB Atlas: mongodb+srv://username:password@cluster.mongodb.net/dbname
# For self-hosted: mongodb://host:port
# NEVER use localhost in production
MONGODB_URI=YOUR_MONGODB_CONNECTION_STRING_HERE
MONGODB_DB_NAME=bayit_plus

# ============================================
# CORS CONFIGURATION (CRITICAL FOR PRODUCTION)
# ============================================

# [REQUIRED in production] Allowed CORS origins
# Format: JSON array string or comma-separated URLs
# Example JSON: '["https://bayit.tv","https://www.bayit.tv","https://api.bayit.tv"]'
# Example CSV: https://bayit.tv,https://www.bayit.tv
# In DEBUG mode: defaults to localhost:3000,localhost:8001
BACKEND_CORS_ORIGINS=YOUR_CORS_ORIGINS_HERE

# ============================================
# GOOGLE CLOUD (REQUIRED)
# ============================================

# [REQUIRED] Google Cloud Project ID
GCP_PROJECT_ID=YOUR_GCP_PROJECT_ID_HERE

# [OPTIONAL] Google Cloud Storage bucket for media files
# Required if STORAGE_TYPE=gcs
GCS_BUCKET_NAME=YOUR_GCS_BUCKET_NAME_HERE

# [OPTIONAL] CDN base URL for serving media (Cloud CDN or CloudFlare)
CDN_BASE_URL=https://cdn.your-domain.com

# Storage type: "local", "s3", or "gcs"
# local: Development only - files stored on local filesystem
# gcs: Production recommended - files stored in Google Cloud Storage
STORAGE_TYPE=gcs

# ============================================
# FRONTEND URLS (REQUIRED FOR EMAIL/VERIFICATION)
# ============================================

# [REQUIRED] Frontend URL for password reset links, email verification
# Used in email templates and redirect flows
FRONTEND_URL=https://your-frontend-domain.com

# [REQUIRED] Web frontend URL for verification links
FRONTEND_WEB_URL=https://your-frontend-domain.com

# Mobile app deep link scheme (app-specific, rarely needs changing)
FRONTEND_MOBILE_URL=bayitplus://

# ============================================
# AUTHENTICATION PROVIDERS
# ============================================

# [OPTIONAL] Google OAuth (for "Sign in with Google")
# Get credentials from: https://console.cloud.google.com/apis/credentials
GOOGLE_CLIENT_ID=YOUR_GOOGLE_CLIENT_ID_HERE
GOOGLE_CLIENT_SECRET=YOUR_GOOGLE_CLIENT_SECRET_HERE
GOOGLE_REDIRECT_URI=https://your-domain.com/auth/google/callback

# [OPTIONAL] Apple Sign In (for iOS/tvOS)
# Get credentials from: https://developer.apple.com/account/resources/authkeys/list
APPLE_KEY_ID=YOUR_APPLE_KEY_ID
APPLE_TEAM_ID=YOUR_APPLE_TEAM_ID
APPLE_KEY_PATH=credentials/apple/AuthKey_XXXXXXXXXX.p8
APPLE_BUNDLE_ID_IOS=com.yourapp.ios
APPLE_BUNDLE_ID_TVOS=com.yourapp.tvos

# ============================================
# AI SERVICES
# ============================================

# [OPTIONAL] Anthropic Claude API (for AI features, content localization)
# Get key from: https://console.anthropic.com/
ANTHROPIC_API_KEY=YOUR_ANTHROPIC_API_KEY_HERE
CLAUDE_MODEL=claude-sonnet-4-20250514
CLAUDE_MAX_TOKENS_SHORT=200
CLAUDE_MAX_TOKENS_LONG=500

# [OPTIONAL] OpenAI API (for Whisper speech-to-text)
# Get key from: https://platform.openai.com/api-keys
OPENAI_API_KEY=YOUR_OPENAI_API_KEY_HERE

# [OPTIONAL] ElevenLabs API (for TTS and STT)
# Get key from: https://elevenlabs.io/
ELEVENLABS_API_KEY=YOUR_ELEVENLABS_API_KEY_HERE
ELEVENLABS_WEBHOOK_SECRET=YOUR_ELEVENLABS_WEBHOOK_SECRET_HERE
ELEVENLABS_DEFAULT_VOICE_ID=EXAVITQu4vr4xnSDxMaL
ELEVENLABS_SUPPORT_VOICE_ID=YOUR_CUSTOM_VOICE_ID_HERE

# Speech-to-Text Provider: "google", "whisper", or "elevenlabs"
SPEECH_TO_TEXT_PROVIDER=google

# Live Translation Provider: "google", "openai", or "claude"
LIVE_TRANSLATION_PROVIDER=google

# ============================================
# LIVE FEATURE QUOTAS (Subtitles & Dubbing)
# ============================================
# Per-user usage limits for live subtitles and live dubbing features
# Prevents abuse and controls AI service costs

# [OPTIONAL] Default quota limits for Premium tier (minutes)
# These apply to newly created users or users without custom quotas
LIVE_QUOTA_PREMIUM_SUBTITLE_MINUTES_PER_HOUR=60
LIVE_QUOTA_PREMIUM_SUBTITLE_MINUTES_PER_DAY=240
LIVE_QUOTA_PREMIUM_SUBTITLE_MINUTES_PER_MONTH=2000

LIVE_QUOTA_PREMIUM_DUBBING_MINUTES_PER_HOUR=30
LIVE_QUOTA_PREMIUM_DUBBING_MINUTES_PER_DAY=120
LIVE_QUOTA_PREMIUM_DUBBING_MINUTES_PER_MONTH=1000

# [OPTIONAL] Default quota limits for Family tier (minutes)
# Family tier gets 2x the Premium tier limits
LIVE_QUOTA_FAMILY_SUBTITLE_MINUTES_PER_HOUR=120
LIVE_QUOTA_FAMILY_SUBTITLE_MINUTES_PER_DAY=480
LIVE_QUOTA_FAMILY_SUBTITLE_MINUTES_PER_MONTH=4000

LIVE_QUOTA_FAMILY_DUBBING_MINUTES_PER_HOUR=60
LIVE_QUOTA_FAMILY_DUBBING_MINUTES_PER_DAY=240
LIVE_QUOTA_FAMILY_DUBBING_MINUTES_PER_MONTH=2000

# [OPTIONAL] Rollover settings (unused minutes carry over to next period)
# Maximum rollover multiplier - can accumulate up to limit * multiplier (default: 2.0)
# Example: 60min/hr limit can accumulate to max 120min available
LIVE_QUOTA_MAX_ROLLOVER_MULTIPLIER=2.0

# [OPTIONAL] Warning threshold percentage (default: 80)
# When user reaches this % of quota, show warning in UI
LIVE_QUOTA_WARNING_THRESHOLD_PERCENTAGE=80

# [OPTIONAL] Cost estimation for internal analytics (USD)
# Used to track estimated AI service costs per user
# Adjust based on actual provider pricing (ElevenLabs, Google Translate)
LIVE_QUOTA_COST_STT_PER_MINUTE=0.006
LIVE_QUOTA_COST_TRANSLATION_PER_1K_CHARS=0.020
LIVE_QUOTA_COST_TTS_PER_1K_CHARS=0.016

# [OPTIONAL] Average characters per minute for cost estimation
# Hebrew: ~600 chars/min (150 words * 4 chars/word)
# English: ~750 chars/min (150 words * 5 chars/word)
LIVE_QUOTA_AVG_CHARS_PER_MINUTE_HEBREW=600
LIVE_QUOTA_AVG_CHARS_PER_MINUTE_ENGLISH=750

# [OPTIONAL] Session cleanup TTL (days)
# Old completed sessions are automatically deleted after this many days (default: 90)
LIVE_QUOTA_SESSION_TTL_DAYS=90

# ============================================
# PODCAST TRANSLATION (AI-POWERED AUDIO TRANSLATION)
# ============================================
# Automatic podcast episode translation with AI-based vocal separation.
# Preserves background music and ambient audio while translating speech.
# Supports Hebrew ↔ English bidirectional translation.

# [OPTIONAL] Enable automatic podcast translation
# When enabled, background worker continuously processes untranslated episodes
PODCAST_TRANSLATION_ENABLED=true

# [OPTIONAL] Polling interval in seconds for translation worker
# How often the worker checks for new episodes to translate (default: 300 = 5 minutes)
PODCAST_TRANSLATION_POLL_INTERVAL=300

# [OPTIONAL] Maximum concurrent translation workers
# Each worker processes one episode at a time (default: 2)
# Higher values require more CPU/memory allocation
PODCAST_TRANSLATION_MAX_CONCURRENT=2

# [OPTIONAL] Temporary directory for audio processing
# Requires ~500MB-2GB of disk space per concurrent translation
# Will be cleaned up automatically after processing
TEMP_AUDIO_DIR=/tmp/podcast_audio

# [OPTIONAL] Default language for podcasts without auto-detection
# Used as fallback when language detection fails (default: "he")
# Options: "he" (Hebrew), "en" (English)
PODCAST_DEFAULT_ORIGINAL_LANGUAGE=he

# [REQUIRED if PODCAST_TRANSLATION_ENABLED=true] Whitelisted domains for audio downloads
# SSRF protection: Only allow downloads from trusted podcast hosting providers
# Format: Comma-separated domain list (no protocols)
# Example: podcasts.apple.com,anchor.fm,soundcloud.com,megaphone.fm
ALLOWED_AUDIO_DOMAINS=

# ============================================
# AUDIO PROCESSING (Vocal Separation & Mixing)
# ============================================

# [OPTIONAL] Demucs model for vocal separation
# "htdemucs_6s" (default) - Best quality, 6-stem separation optimized for speech
# "htdemucs" - 4-stem separation, faster but lower quality
AUDIO_SEPARATION_MODEL=htdemucs_6s

# [OPTIONAL] Device for audio processing
# "cpu" (default) - Works everywhere, slower
# "cuda" - GPU acceleration, requires NVIDIA GPU with CUDA
AUDIO_SEPARATION_DEVICE=cpu

# [OPTIONAL] Whisper model for speech-to-text
# "large-v3" (default) - Best accuracy for Hebrew/English, ~3GB VRAM
# "medium" - Faster, lower accuracy, ~1.5GB VRAM
# "small" - Fastest, lowest accuracy, ~500MB VRAM
STT_MODEL=large-v3

# [OPTIONAL] Device for Whisper STT
# "cpu" (default) - Works everywhere, slower
# "cuda" - GPU acceleration, requires NVIDIA GPU with CUDA
STT_DEVICE=cpu

# ============================================
# AUDIO QUALITY SETTINGS (EBU R128 Normalization)
# ============================================

# [OPTIONAL] Target LUFS (Loudness Units Full Scale) for normalization
# -16.0 (default) - Podcast standard (EBU R128)
# Range: -23.0 (quiet) to -14.0 (loud)
TARGET_LUFS=-16.0

# [OPTIONAL] Peak limiter in dB (prevents clipping)
# -1.5 (default) - Safe headroom for streaming
# Range: -3.0 (more headroom) to -1.0 (closer to max)
PEAK_LIMITER=-1.5

# [OPTIONAL] Vocal volume adjustment in dB
# 0.0 (default) - No adjustment after normalization
# Range: -6.0 (quieter) to +6.0 (louder)
VOCAL_VOLUME_DB=0.0

# [OPTIONAL] Background volume ducking in dB
# -12.0 (default) - Professional ducking (background 12dB quieter than vocals)
# -15.0 - More aggressive ducking (very quiet background)
# -9.0 - Subtle ducking (background more audible)
BACKGROUND_VOLUME_DB=-12.0

# ============================================
# ELEVENLABS TTS VOICE SETTINGS (Podcast Quality)
# ============================================

# [OPTIONAL] Voice stability (0.0-1.0)
# 0.75 (default) - Professional podcast narration
# 0.7-0.8 - Recommended range for natural speech
# Higher values = more consistent, lower values = more expressive
ELEVENLABS_STABILITY=0.75

# [OPTIONAL] Similarity boost (0.0-1.0)
# 0.85 (default) - High consistency for podcast narration
# Higher values = voice stays more consistent across segments
ELEVENLABS_SIMILARITY_BOOST=0.85

# [OPTIONAL] Style/expressiveness (0.0-1.0)
# 0.4 (default) - Moderate expressiveness for podcasts
# 0.0 - Monotone, 1.0 - Very expressive
ELEVENLABS_STYLE=0.4

# [OPTIONAL] Speaker boost (clarity enhancement for speech)
# true (default) - Recommended for Hebrew clarity
# false - Disable if voice sounds over-processed
ELEVENLABS_SPEAKER_BOOST=true

# [OPTIONAL] ElevenLabs TTS model
# "eleven_multilingual_v2" (default) - Best quality for Hebrew/English
# "eleven_turbo_v2" - Faster but lower quality
ELEVENLABS_MODEL=eleven_multilingual_v2

# [OPTIONAL] ElevenLabs voice ID for Hebrew narration
# Get voice IDs from: https://elevenlabs.io/voice-library
# Leave empty to use ELEVENLABS_DEFAULT_VOICE_ID
ELEVENLABS_HEBREW_VOICE_ID=

# [OPTIONAL] ElevenLabs voice ID for English narration
# Get voice IDs from: https://elevenlabs.io/voice-library
# Leave empty to use ELEVENLABS_DEFAULT_VOICE_ID
ELEVENLABS_ENGLISH_VOICE_ID=

# ============================================
# PAYMENTS (STRIPE)
# ============================================

# [OPTIONAL] Stripe API (for subscriptions and payments)
# Get keys from: https://dashboard.stripe.com/apikeys
STRIPE_API_KEY=pk_live_YOUR_STRIPE_PUBLIC_KEY
STRIPE_SECRET_KEY=sk_live_YOUR_STRIPE_SECRET_KEY
STRIPE_WEBHOOK_SECRET=whsec_YOUR_WEBHOOK_SECRET
STRIPE_PRICE_BASIC=price_YOUR_BASIC_PRICE_ID
STRIPE_PRICE_PREMIUM=price_YOUR_PREMIUM_PRICE_ID
STRIPE_PRICE_FAMILY=price_YOUR_FAMILY_PRICE_ID

# ============================================
# EMAIL SERVICE
# ============================================

# [OPTIONAL] SendGrid API (for transactional emails)
# Get key from: https://app.sendgrid.com/settings/api_keys
SENDGRID_API_KEY=SG.YOUR_SENDGRID_API_KEY
SENDGRID_FROM_EMAIL=noreply@your-domain.com
ADMIN_EMAIL_ADDRESSES=admin@your-domain.com,team@your-domain.com

# ============================================
# SMS SERVICE
# ============================================

# [OPTIONAL] Twilio API (for SMS verification)
# Get credentials from: https://console.twilio.com/
TWILIO_ACCOUNT_SID=YOUR_TWILIO_ACCOUNT_SID
TWILIO_AUTH_TOKEN=YOUR_TWILIO_AUTH_TOKEN
TWILIO_PHONE_NUMBER=+1234567890

# Verification settings
EMAIL_VERIFICATION_TOKEN_EXPIRE_HOURS=24
PHONE_VERIFICATION_CODE_EXPIRE_MINUTES=10
MAX_VERIFICATION_ATTEMPTS_PER_HOUR=3

# ============================================
# CONTENT ENRICHMENT APIs
# ============================================

# [OPTIONAL but recommended] TMDB API (for metadata, posters, ratings)
# Get FREE key from: https://www.themoviedb.org/settings/api
TMDB_API_KEY=YOUR_TMDB_V3_API_KEY_HERE
TMDB_API_TOKEN=YOUR_TMDB_V4_BEARER_TOKEN_HERE

# [OPTIONAL] OpenSubtitles API (for automatic subtitle downloads)
# Register at: https://www.opensubtitles.com/consumers
OPENSUBTITLES_API_KEY=YOUR_OPENSUBTITLES_API_KEY_HERE
OPENSUBTITLES_USERNAME=YOUR_OPENSUBTITLES_USERNAME
OPENSUBTITLES_PASSWORD=YOUR_OPENSUBTITLES_PASSWORD
OPENSUBTITLES_API_BASE_URL=https://api.opensubtitles.com/api/v1
OPENSUBTITLES_USER_AGENT=Bayit+ v1.0
OPENSUBTITLES_DOWNLOAD_LIMIT_PER_DAY=1500
OPENSUBTITLES_RATE_LIMIT_REQUESTS=40
OPENSUBTITLES_RATE_LIMIT_WINDOW_SECONDS=10

# Subtitle caching
SUBTITLE_SEARCH_CACHE_TTL_DAYS=7
SUBTITLE_NOT_FOUND_CACHE_TTL_DAYS=30
SUBTITLE_BATCH_SIZE=20

# ============================================
# DRM PROTECTION
# ============================================

# [OPTIONAL] DRM license server (for protected content)
DRM_LICENSE_URL=
DRM_API_KEY=

# ============================================
# UPLOAD CONFIGURATION
# ============================================

# Directory for temporary upload chunks
UPLOAD_DIR=/tmp/bayit-uploads

# Upload monitoring (background scanning for new content)
UPLOAD_MONITOR_ENABLED=false
UPLOAD_MONITOR_INTERVAL=3600

# Upload session cleanup
UPLOAD_SESSION_MAX_AGE_HOURS=24
UPLOAD_SESSION_CLEANUP_INTERVAL_SECONDS=3600
UPLOAD_SESSION_TIMEOUT_HOURS=2

# GCS Upload configuration (for large file uploads)
GCS_UPLOAD_TIMEOUT_SECONDS=600
GCS_UPLOAD_CHUNK_SIZE_MB=8
GCS_UPLOAD_MAX_RETRIES=5
GCS_UPLOAD_RETRY_INITIAL_DELAY_SECONDS=1.0
GCS_UPLOAD_RETRY_MAX_DELAY_SECONDS=60.0

# ============================================
# LIBRARIAN AI AGENT CONFIGURATION
# ============================================
# The Librarian is an AI agent that audits and maintains content quality

# [REQUIRED] Daily Audit Schedule (lightweight rule-based checks)
LIBRARIAN_DAILY_AUDIT_CRON=0 2 * * *
LIBRARIAN_DAILY_AUDIT_TIME=2:00 AM Israel Time
LIBRARIAN_DAILY_AUDIT_MODE=Rule-based
LIBRARIAN_DAILY_AUDIT_COST=~$0.01/day
LIBRARIAN_DAILY_AUDIT_STATUS=ENABLED
LIBRARIAN_DAILY_AUDIT_DESCRIPTION=Scans recent content and random 10% sample. Auto-fixes safe issues.

# [REQUIRED] Weekly AI Audit Schedule (full AI-powered analysis)
LIBRARIAN_WEEKLY_AUDIT_CRON=0 3 * * 0
LIBRARIAN_WEEKLY_AUDIT_TIME=Sundays 3:00 AM Israel Time
LIBRARIAN_WEEKLY_AUDIT_MODE=AI Agent
LIBRARIAN_WEEKLY_AUDIT_COST=~$0.50/week
LIBRARIAN_WEEKLY_AUDIT_STATUS=ENABLED
LIBRARIAN_WEEKLY_AUDIT_DESCRIPTION=Claude decides what to check and fix. Sends email only for major issues.

# [REQUIRED] Librarian Audit Limits
LIBRARIAN_MAX_ITERATIONS=50
LIBRARIAN_DEFAULT_BUDGET_USD=10.0
LIBRARIAN_MIN_BUDGET_USD=0.1
LIBRARIAN_MAX_BUDGET_USD=20.0
LIBRARIAN_BUDGET_STEP_USD=0.5

# [REQUIRED] Librarian Pagination Settings
LIBRARIAN_REPORTS_LIMIT=10
LIBRARIAN_ACTIONS_LIMIT=50
LIBRARIAN_ACTIVITY_PAGE_SIZE=10

# [REQUIRED] Librarian UI Settings
LIBRARIAN_ID_TRUNCATE_LENGTH=8
LIBRARIAN_MODAL_MAX_HEIGHT=600

# ============================================
# VOICE/WAKE WORD DETECTION
# ============================================

# [OPTIONAL] Picovoice Porcupine (for wake word detection)
# Get key from: https://console.picovoice.ai/
PICOVOICE_ACCESS_KEY=YOUR_PICOVOICE_ACCESS_KEY_HERE

# ============================================
# SUPPORT SYSTEM
# ============================================

SUPPORT_CHAT_MAX_TOKENS=300
SUPPORT_CONTEXT_MAX_DOCS=3
SUPPORT_ESCALATION_THRESHOLD=0.5
SUPPORT_TICKET_ADMIN_EMAILS=support@your-domain.com

# ============================================
# EPG (ELECTRONIC PROGRAM GUIDE)
# ============================================

EPG_DEFAULT_TIME_WINDOW_HOURS=6
EPG_PAST_HOURS=2
EPG_FUTURE_HOURS=4
EPG_CACHE_TTL_SECONDS=300
EPG_INGESTION_INTERVAL_HOURS=6

# ============================================
# CATCH-UP TV
# ============================================

CATCHUP_RETENTION_DAYS=7
CATCHUP_MAX_DURATION_HOURS=4

# ============================================
# SEARCH CONFIGURATION
# ============================================

LLM_SEARCH_MAX_RESULTS=50
LLM_SEARCH_TIMEOUT_SECONDS=30
SEARCH_CACHE_TTL_SECONDS=300
SEARCH_SUGGESTIONS_LIMIT=5
SEARCH_SUBTITLE_RESULT_LIMIT=50
SEARCH_DEFAULT_PAGE_SIZE=20
SEARCH_MAX_PAGE_SIZE=50

# ============================================
# CHAT TRANSLATION
# ============================================

CHAT_TRANSLATION_ENABLED=true
CHAT_TRANSLATION_TIMEOUT_SECONDS=2.0
CHAT_TRANSLATION_CACHE_TTL_DAYS=7
TRANSLATION_MEMORY_CACHE_SIZE=1000

# ============================================
# JUDAISM SECTION
# ============================================

# Jewish News Aggregation
JEWISH_NEWS_CACHE_TTL_MINUTES=15
JEWISH_NEWS_SYNC_INTERVAL_MINUTES=30
JEWISH_NEWS_REQUEST_TIMEOUT_SECONDS=10.0

# Jewish Calendar Integration
HEBCAL_API_BASE_URL=https://www.hebcal.com
SEFARIA_API_BASE_URL=https://www.sefaria.org/api
JEWISH_CALENDAR_CACHE_TTL_HOURS=6

# Jewish Community Directory
COMMUNITY_SEARCH_RADIUS_MILES=25
COMMUNITY_DEFAULT_REGION=nyc
US_JEWISH_REGIONS=nyc,la,chicago,miami,boston,philadelphia,atlanta,dallas,denver,seattle
COMMUNITY_SCRAPE_INTERVAL_HOURS=168

# Torah Content RSS
YUTORAH_RSS_URL=https://www.yutorah.org/rss/
CHABAD_MULTIMEDIA_RSS_URL=https://www.chabad.org/multimedia/rss.xml
TORAHANYTIME_RSS_URL=https://www.torahanytime.com/feed

# ============================================
# LOCATION-BASED CONTENT (JERUSALEM/TEL AVIV)
# ============================================

JERUSALEM_CONTENT_CACHE_TTL_MINUTES=15
JERUSALEM_CONTENT_REQUEST_TIMEOUT_SECONDS=10.0
JERUSALEM_CONTENT_MIN_RELEVANCE_SCORE=0.3

TEL_AVIV_CONTENT_CACHE_TTL_MINUTES=15
TEL_AVIV_CONTENT_REQUEST_TIMEOUT_SECONDS=10.0
TEL_AVIV_CONTENT_MIN_RELEVANCE_SCORE=0.3

# ============================================
# GLOBAL CULTURES
# ============================================

CULTURES_ENABLED=true
CULTURES_CACHE_TTL_MINUTES=15
CULTURES_REQUEST_TIMEOUT_SECONDS=10.0
CULTURES_MIN_RELEVANCE_SCORE=0.3
CULTURES_DEFAULT_LIMIT=20
CULTURES_MAX_LIMIT=50
CULTURES_DEFAULT_ID=israeli
CULTURES_SUPPORTED=israeli,chinese,japanese,korean,indian

# ============================================
# KIDS CONTENT
# ============================================

# [OPTIONAL] YouTube API for kids channel imports
YOUTUBE_API_KEY=YOUR_YOUTUBE_API_KEY_HERE
KIDS_YOUTUBE_CHANNEL_IDS=
KIDS_PODCAST_RSS_FEEDS=
KIDS_ARCHIVE_ORG_ENABLED=true
KIDS_CONTENT_AGE_RATINGS=3,5,7,10,12
KIDS_CONTENT_AUTO_APPROVE_THRESHOLD=0.9
KIDS_CONTENT_REQUIRE_MODERATION=true
KIDS_LIBRARIAN_AUDIT_CRON=0 3 * * *
KIDS_LIBRARIAN_AUDIT_ENABLED=true
KIDS_CONTENT_CACHE_TTL_MINUTES=15
KIDS_CONTENT_MIN_RELEVANCE_SCORE=0.3
KIDS_CONTENT_SAFE_SEARCH_ENABLED=true
KIDS_CONTENT_DEFAULT_AGE_MAX=12

# ============================================
# YOUTUBE VALIDATION
# ============================================
# Configuration for YouTube video link validation and thumbnail fetching

# Concurrent limit for batch validation (lower to avoid YouTube rate limiting)
YOUTUBE_VALIDATION_CONCURRENT_LIMIT=5

# Timeout in seconds for individual video validation requests
YOUTUBE_VALIDATION_TIMEOUT_SECONDS=10.0

# Cache TTL in hours for valid YouTube videos (videos confirmed available)
YOUTUBE_CACHE_TTL_VALID_HOURS=72

# Cache TTL in hours for invalid YouTube videos (recheck sooner for recovery)
YOUTUBE_CACHE_TTL_INVALID_HOURS=12

# Minimum thumbnail file size in bytes to consider valid (avoid placeholder images)
YOUTUBE_THUMBNAIL_MIN_SIZE_BYTES=1000

# Timeout in seconds for thumbnail fetch requests
YOUTUBE_THUMBNAIL_TIMEOUT_SECONDS=5.0

# ============================================
# SERIES LINKER
# ============================================

SERIES_LINKER_TITLE_SIMILARITY_THRESHOLD=0.85
SERIES_LINKER_AUTO_LINK_CONFIDENCE_THRESHOLD=0.90
SERIES_LINKER_AUTO_LINK_BATCH_SIZE=50
SERIES_LINKER_DUPLICATE_RESOLUTION_STRATEGY=keep_highest_quality
SERIES_LINKER_CREATE_MISSING_SERIES=true

# ============================================
# OBSERVABILITY & LOGGING
# ============================================

# [OPTIONAL] Sentry Error Tracking
# Get DSN from: https://sentry.io/settings/projects/
SENTRY_DSN=
SENTRY_ENVIRONMENT=development
SENTRY_RELEASE=
SENTRY_TRACES_SAMPLE_RATE=0.2

# Logging Configuration
LOG_LEVEL=INFO
CORRELATION_ID_HEADER=X-Correlation-ID
REQUEST_TIMEOUT_WARNING_MS=5000

# ============================================
# WEBAUTHN (PASSKEY) AUTHENTICATION
# ============================================
# Passkey-based content protection using WebAuthn/FIDO2 standard

# [REQUIRED] Relying Party ID - must match the domain where passkeys are created
# For production: bayit.tv
# For development: localhost
WEBAUTHN_RP_ID=YOUR_WEBAUTHN_RP_ID_HERE

# [REQUIRED] Relying Party Name - displayed to users during passkey creation
WEBAUTHN_RP_NAME=Bayit Plus

# [REQUIRED] Expected origin(s) - comma-separated list of allowed origins
# For production: https://bayit.tv,https://www.bayit.tv
# For development: http://localhost:3000,http://localhost:8000
WEBAUTHN_ORIGIN=YOUR_WEBAUTHN_ORIGINS_HERE

# Passkey session duration in days (default: 7)
PASSKEY_SESSION_DURATION_DAYS=7

# Challenge expiration time in seconds (default: 300 = 5 minutes)
PASSKEY_CHALLENGE_EXPIRY_SECONDS=300

# Maximum number of passkeys per user (default: 10)
PASSKEY_MAX_CREDENTIALS_PER_USER=10

# ============================================
# OLORIN.AI PLATFORM
# ============================================
# AI overlay platform providing capabilities to third-party content providers.
# Features: Realtime Dubbing, Semantic Search, Cultural Context, Recap Agent
#
# Configuration Structure (Nested):
#   OLORIN_*               - Feature flags (top-level)
#   PARTNER_*              - Partner API authentication and rate limiting
#   PINECONE_*             - Vector database for semantic search
#   EMBEDDING_*            - Embedding model configuration
#   DUBBING_*              - Realtime dubbing configuration
#   RECAP_*                - Recap agent configuration
#   CULTURAL_*             - Cultural context configuration

# ============================================
# FEATURE FLAGS
# ============================================
# [REQUIRED] Enable/disable individual Olorin capabilities
# All features disabled by default for gradual rollout

# Enable realtime Hebrew→English/Spanish dubbing (requires ELEVENLABS_API_KEY, ANTHROPIC_API_KEY)
OLORIN_DUBBING_ENABLED=false

# Enable semantic vector search (requires PINECONE_API_KEY, OPENAI_API_KEY)
OLORIN_SEMANTIC_SEARCH_ENABLED=false

# Enable Israeli/Jewish cultural reference detection (requires ANTHROPIC_API_KEY)
OLORIN_CULTURAL_CONTEXT_ENABLED=false

# Enable live broadcast recap summaries (requires ANTHROPIC_API_KEY)
OLORIN_RECAP_ENABLED=false

# ============================================
# PARTNER API (Authentication & Rate Limiting)
# ============================================
# [REQUIRED if any Olorin feature is enabled]

# [CRITICAL] API key salt for bcrypt hashing (minimum 32 characters)
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
# NEVER use default values, NEVER commit real keys to version control
PARTNER_API_KEY_SALT=YOUR_PARTNER_API_KEY_SALT_HERE_MIN_32_CHARS

# Default rate limit for partner API calls (requests per minute)
# Applies to all partners unless overridden in database
PARTNER_DEFAULT_RATE_LIMIT_RPM=60

# Timeout for partner webhook deliveries (seconds)
# Webhooks exceeding this timeout will be marked as failed
PARTNER_WEBHOOK_TIMEOUT_SECONDS=10.0

# ============================================
# PINECONE (Vector Database for Semantic Search)
# ============================================
# [REQUIRED if OLORIN_SEMANTIC_SEARCH_ENABLED=true]

# [REQUIRED] Pinecone API key
# Get free key from: https://www.pinecone.io/
PINECONE_API_KEY=YOUR_PINECONE_API_KEY_HERE

# Pinecone environment/region (e.g., us-east-1-aws, us-west-2-aws, eu-west1-gcp)
PINECONE_ENVIRONMENT=us-east-1-aws

# Pinecone index name for content embeddings
# Must match the index created in Pinecone dashboard
PINECONE_INDEX_NAME=olorin-content

# ============================================
# EMBEDDINGS (OpenAI for Semantic Search)
# ============================================
# [REQUIRED if OLORIN_SEMANTIC_SEARCH_ENABLED=true]

# OpenAI embedding model name
# Options: text-embedding-3-small (1536 dims), text-embedding-3-large (3072 dims)
EMBEDDING_MODEL=text-embedding-3-small

# Embedding vector dimensions (must match Pinecone index configuration)
# text-embedding-3-small: 1536, text-embedding-3-large: 3072
EMBEDDING_DIMENSIONS=1536

# ============================================
# DUBBING (Realtime Hebrew→English/Spanish)
# ============================================
# [Applies if OLORIN_DUBBING_ENABLED=true]
# End-to-end latency target: <2 seconds (Audio→STT→Translation→TTS)

# Maximum concurrent dubbing sessions per Cloud Run instance
# Higher values require more memory/CPU allocation
DUBBING_MAX_CONCURRENT_SESSIONS=100

# Session timeout (minutes of inactivity before auto-close)
# Sessions exceeding this timeout will be terminated to free resources
DUBBING_SESSION_TIMEOUT_MINUTES=120

# Target end-to-end latency (milliseconds)
# Measures Audio→STT→Translation→TTS pipeline latency
DUBBING_TARGET_LATENCY_MS=2000

# ============================================
# RECAP AGENT (Live Broadcast Summaries)
# ============================================
# [Applies if OLORIN_RECAP_ENABLED=true]
# Generates context summaries for late-joiners to live broadcasts

# Maximum transcript tokens to include in recap context
# Claude 3.5 Sonnet supports up to 200k tokens, but 8k provides fast summaries
RECAP_MAX_CONTEXT_TOKENS=8000

# Default time window for recap generation (minutes)
# How far back in the transcript to summarize
RECAP_WINDOW_DEFAULT_MINUTES=15

# Maximum tokens for generated summary
# Shorter summaries are faster and more focused
RECAP_SUMMARY_MAX_TOKENS=300

# ============================================
# CULTURAL CONTEXT (Israeli/Jewish References)
# ============================================
# [Applies if OLORIN_CULTURAL_CONTEXT_ENABLED=true]
# Detects and explains Israeli/Jewish cultural references in content

# Cache TTL for cultural reference lookups (hours)
# References are cached to reduce Claude API costs
CULTURAL_REFERENCE_CACHE_TTL_HOURS=24

# Minimum confidence threshold for reference detection (0.0-1.0)
# Higher values reduce false positives but may miss subtle references
CULTURAL_DETECTION_MIN_CONFIDENCE=0.7

# ============================================
# METERING (Cost Calculation)
# ============================================
# [OPTIONAL] Cost rates for billing calculations
# All values are in USD. Defaults match current provider pricing.

# Cost per audio second for STT (ElevenLabs ~$0.04/1000 seconds)
METERING_COST_PER_AUDIO_SECOND_STT=0.00004

# Cost per audio second for TTS (ElevenLabs ~$0.24/1000 seconds)
METERING_COST_PER_AUDIO_SECOND_TTS=0.00024

# Cost per 1000 translation characters (Google ~$20/1M chars)
METERING_COST_PER_1K_TRANSLATION_CHARS=0.00002

# Cost per 1000 LLM tokens (Claude Sonnet ~$3/1M input tokens)
METERING_COST_PER_1K_TOKENS_LLM=0.003

# Cost per 1000 embedding tokens (OpenAI ~$0.02/1M tokens)
METERING_COST_PER_1K_EMBEDDING_TOKENS=0.00002

# ============================================
# RECAP AGENT (Session Limits)
# ============================================
# [OPTIONAL] Limits to prevent unbounded memory growth in long sessions

# Maximum transcript segments per session before FIFO trimming (default: 5000)
RECAP_MAX_TRANSCRIPT_SEGMENTS=5000

# Maximum recaps per session before FIFO trimming (default: 100)
RECAP_MAX_RECAPS_PER_SESSION=100

# ============================================
# CULTURAL CONTEXT (Cache Limits)
# ============================================
# [OPTIONAL] LRU cache settings for cultural reference lookups

# Maximum entries in cultural reference cache before LRU eviction (default: 10000)
CULTURAL_REFERENCE_CACHE_MAX_ENTRIES=10000

# ============================================
# DUBBING (STT Provider)
# ============================================
# [OPTIONAL] STT provider for dubbing (default: elevenlabs)
DUBBING_STT_PROVIDER=elevenlabs

# ============================================
# RESILIENCE (Circuit Breaker & Retry)
# ============================================
# [OPTIONAL] Circuit breaker and retry configuration for external services

# Number of failures before circuit opens (default: 5)
RESILIENCE_CIRCUIT_BREAKER_FAILURE_THRESHOLD=5

# Seconds to wait before attempting recovery (default: 30)
RESILIENCE_CIRCUIT_BREAKER_RECOVERY_TIMEOUT_SECONDS=30

# Max calls in half-open state before deciding (default: 3)
RESILIENCE_CIRCUIT_BREAKER_HALF_OPEN_MAX_CALLS=3

# Maximum retry attempts (default: 3)
RESILIENCE_RETRY_MAX_ATTEMPTS=3

# Initial delay between retries in seconds (default: 1.0)
RESILIENCE_RETRY_INITIAL_DELAY_SECONDS=1.0

# Maximum delay between retries in seconds (default: 60.0)
RESILIENCE_RETRY_MAX_DELAY_SECONDS=60.0

# Base for exponential backoff (default: 2.0)
RESILIENCE_RETRY_EXPONENTIAL_BASE=2.0

# ============================================
# DATABASE (Separate Olorin Database - Phase 2)
# ============================================
# [OPTIONAL] Separate MongoDB database for Olorin data
# When enabled, Olorin models (partners, usage, sessions) use dedicated database
# Bayit+ Content model remains shared for metadata access

# Enable separate database for Olorin (set to true for Phase 2)
OLORIN_USE_SEPARATE_DATABASE=false

# [OPTIONAL] MongoDB connection URL for Olorin database
# If not set, uses main MONGODB_URL (backward compatible)
# For production: mongodb+srv://username:password@cluster.mongodb.net/olorin_platform
OLORIN_MONGODB_URL=

# MongoDB database name for Olorin data (default: olorin_platform)
OLORIN_MONGODB_DB_NAME=olorin_platform
