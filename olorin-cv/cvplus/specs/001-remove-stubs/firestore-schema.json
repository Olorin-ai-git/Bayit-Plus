{
  "collections": {
    "templates": {
      "description": "CV template definitions",
      "fields": {
        "id": { "type": "string", "required": true, "description": "Unique template identifier" },
        "name": { "type": "string", "required": true, "description": "Template display name" },
        "description": { "type": "string", "required": true, "description": "Template description" },
        "category": { "type": "string", "required": true, "description": "Template category (e.g., 'professional', 'modern', 'creative')" },
        "isPremium": { "type": "boolean", "required": true, "description": "Whether template requires premium subscription" },
        "isFeatured": { "type": "boolean", "required": true, "description": "Whether template is featured" },
        "thumbnailUrl": { "type": "string", "required": false, "description": "URL to template thumbnail" },
        "previewUrl": { "type": "string", "required": false, "description": "URL to template preview" },
        "styling": { "type": "object", "required": false, "description": "Template styling configuration" },
        "compatibility": { "type": "array", "required": false, "description": "Supported feature flags" },
        "version": { "type": "string", "required": true, "description": "Template version" },
        "createdAt": { "type": "timestamp", "required": true, "description": "Creation timestamp" },
        "updatedAt": { "type": "timestamp", "required": true, "description": "Last update timestamp" }
      },
      "indexes": [
        { "fields": ["category", "isPremium"], "description": "For filtering by category and premium status" }
      ],
      "securityRules": "allow read: if request.auth != null; allow write: if request.auth.token.isAdmin == true;"
    },
    "template_metadata": {
      "description": "Usage statistics and ratings for templates",
      "fields": {
        "templateId": { "type": "string", "required": true, "description": "Reference to template" },
        "usageCount": { "type": "number", "required": true, "description": "Total usage count" },
        "rating": { "type": "number", "required": true, "description": "Average rating (0-5)" },
        "reviewCount": { "type": "number", "required": true, "description": "Number of reviews" },
        "downloadCount": { "type": "number", "required": true, "description": "Total downloads" },
        "lastUsed": { "type": "timestamp", "required": false, "description": "Last usage timestamp" },
        "popularWith": { "type": "array", "required": false, "description": "Popular with user segments" },
        "successMetrics": { "type": "object", "required": false, "description": "Success tracking data" }
      },
      "indexes": [
        { "fields": ["templateId"], "description": "Primary lookup" }
      ],
      "securityRules": "allow read: if request.auth != null; allow write: if request.auth.token.isAdmin == true;"
    },
    "template_usage": {
      "description": "Individual template usage tracking",
      "fields": {
        "templateId": { "type": "string", "required": true },
        "userId": { "type": "string", "required": true },
        "jobId": { "type": "string", "required": true },
        "startedAt": { "type": "timestamp", "required": true },
        "completedAt": { "type": "timestamp", "required": false },
        "customizations": { "type": "object", "required": false },
        "outcome": { "type": "string", "required": false },
        "feedback": { "type": "string", "required": false }
      },
      "indexes": [
        { "fields": ["userId", "templateId"], "description": "User template history" }
      ],
      "securityRules": "allow read: if request.auth.uid == resource.data.userId; allow write: if request.auth.uid == resource.data.userId;"
    },
    "template_statistics": {
      "description": "Aggregated template statistics",
      "fields": {
        "totalTemplates": { "type": "number", "required": true },
        "templatesByCategory": { "type": "object", "required": true },
        "mostPopularTemplates": { "type": "array", "required": true },
        "averageRating": { "type": "number", "required": true },
        "lastUpdated": { "type": "timestamp", "required": true }
      },
      "securityRules": "allow read: if request.auth != null; allow write: if request.auth.token.isAdmin == true;"
    },
    "jobs": {
      "description": "Job/workflow instances",
      "fields": {
        "id": { "type": "string", "required": true },
        "userId": { "type": "string", "required": true },
        "status": { "type": "string", "required": true, "description": "Job status (pending, in_progress, completed, failed)" },
        "title": { "type": "string", "required": true },
        "description": { "type": "string", "required": false },
        "templateId": { "type": "string", "required": true },
        "features": { "type": "array", "required": true },
        "createdAt": { "type": "timestamp", "required": true },
        "updatedAt": { "type": "timestamp", "required": true },
        "startedAt": { "type": "timestamp", "required": false },
        "completedAt": { "type": "timestamp", "required": false },
        "priority": { "type": "string", "required": false }
      },
      "indexes": [
        { "fields": ["userId", "status"], "description": "User-specific job queries" }
      ],
      "securityRules": "allow read: if request.auth.uid == resource.data.userId || request.auth.token.isAdmin == true; allow write: if request.auth.uid == resource.data.userId;"
    },
    "features": {
      "description": "Feature definitions",
      "fields": {
        "id": { "type": "string", "required": true },
        "name": { "type": "string", "required": true },
        "description": { "type": "string", "required": true },
        "category": { "type": "string", "required": true },
        "status": { "type": "string", "required": true },
        "priority": { "type": "number", "required": true },
        "estimatedDuration": { "type": "number", "required": false },
        "dependencies": { "type": "array", "required": false },
        "progress": { "type": "number", "required": false },
        "metadata": { "type": "object", "required": false }
      },
      "securityRules": "allow read: if request.auth != null; allow write: if request.auth.token.isAdmin == true;"
    },
    "job_features": {
      "description": "Features associated with specific jobs",
      "fields": {
        "jobId": { "type": "string", "required": true },
        "featureId": { "type": "string", "required": true },
        "status": { "type": "string", "required": true },
        "progress": { "type": "number", "required": true },
        "startedAt": { "type": "timestamp", "required": false },
        "completedAt": { "type": "timestamp", "required": false },
        "metadata": { "type": "object", "required": false }
      },
      "indexes": [
        { "fields": ["jobId", "status"], "description": "Job feature retrieval" }
      ],
      "securityRules": "allow read: if request.auth.uid == get(/databases/$(database)/documents/jobs/$(resource.data.jobId)).data.userId; allow write: if request.auth.uid == get(/databases/$(database)/documents/jobs/$(resource.data.jobId)).data.userId;"
    },
    "completed_features": {
      "description": "Completed feature records",
      "fields": {
        "id": { "type": "string", "required": true },
        "jobId": { "type": "string", "required": true },
        "featureId": { "type": "string", "required": true },
        "completedAt": { "type": "timestamp", "required": true },
        "completionData": { "type": "object", "required": false },
        "completedBy": { "type": "string", "required": true },
        "executionTime": { "type": "number", "required": false },
        "quality": { "type": "number", "required": false }
      },
      "securityRules": "allow read: if request.auth.uid == get(/databases/$(database)/documents/jobs/$(resource.data.jobId)).data.userId; allow write: if request.auth.uid == get(/databases/$(database)/documents/jobs/$(resource.data.jobId)).data.userId;"
    },
    "skipped_features": {
      "description": "Skipped feature records",
      "fields": {
        "id": { "type": "string", "required": true },
        "jobId": { "type": "string", "required": true },
        "featureId": { "type": "string", "required": true },
        "skippedAt": { "type": "timestamp", "required": true },
        "skipReason": { "type": "string", "required": true },
        "skippedBy": { "type": "string", "required": true },
        "impactAssessment": { "type": "object", "required": false }
      },
      "securityRules": "allow read: if request.auth.uid == get(/databases/$(database)/documents/jobs/$(resource.data.jobId)).data.userId; allow write: if request.auth.uid == get(/databases/$(database)/documents/jobs/$(resource.data.jobId)).data.userId;"
    },
    "feature_dependencies": {
      "description": "Feature dependency graph",
      "fields": {
        "featureId": { "type": "string", "required": true },
        "dependsOn": { "type": "array", "required": true },
        "dependencyType": { "type": "string", "required": true },
        "description": { "type": "string", "required": false }
      },
      "securityRules": "allow read: if request.auth != null; allow write: if request.auth.token.isAdmin == true;"
    },
    "placeholder_values": {
      "description": "Placeholder values for jobs",
      "fields": {
        "jobId": { "type": "string", "required": true },
        "placeholderKey": { "type": "string", "required": true },
        "value": { "type": "string", "required": true },
        "type": { "type": "string", "required": true },
        "isRequired": { "type": "boolean", "required": true },
        "lastUpdated": { "type": "timestamp", "required": true },
        "source": { "type": "string", "required": false }
      },
      "indexes": [
        { "fields": ["jobId", "placeholderKey"], "description": "Placeholder retrieval" }
      ],
      "securityRules": "allow read: if request.auth.uid == get(/databases/$(database)/documents/jobs/$(resource.data.jobId)).data.userId; allow write: if request.auth.uid == get(/databases/$(database)/documents/jobs/$(resource.data.jobId)).data.userId;"
    },
    "placeholder_templates": {
      "description": "Placeholder definitions for templates",
      "fields": {
        "templateId": { "type": "string", "required": true },
        "placeholders": { "type": "array", "required": true },
        "sections": { "type": "array", "required": false }
      },
      "securityRules": "allow read: if request.auth != null; allow write: if request.auth.token.isAdmin == true;"
    },
    "placeholder_statistics": {
      "description": "Placeholder usage statistics",
      "fields": {
        "mostUsedPlaceholders": { "type": "array", "required": true },
        "averageFillRate": { "type": "number", "required": true },
        "commonlySkippedPlaceholders": { "type": "array", "required": true },
        "lastUpdated": { "type": "timestamp", "required": true }
      },
      "securityRules": "allow read: if request.auth != null; allow write: if request.auth.token.isAdmin == true;"
    },
    "certification_badges": {
      "description": "Issued certification badges",
      "fields": {
        "id": { "type": "string", "required": true },
        "userId": { "type": "string", "required": true },
        "badgeType": { "type": "string", "required": true },
        "name": { "type": "string", "required": true },
        "status": { "type": "string", "required": true },
        "issuedAt": { "type": "timestamp", "required": true },
        "expiresAt": { "type": "timestamp", "required": false },
        "verificationCode": { "type": "string", "required": true },
        "verificationUrl": { "type": "string", "required": false },
        "criteria": { "type": "object", "required": false },
        "evidence": { "type": "object", "required": false }
      },
      "indexes": [
        { "fields": ["userId", "badgeType"], "description": "User badge queries" }
      ],
      "securityRules": "allow read: if request.auth.uid == resource.data.userId || request.auth.token.isAdmin == true; allow write: if request.auth.token.isAdmin == true;"
    },
    "badge_definitions": {
      "description": "Badge type definitions",
      "fields": {
        "type": { "type": "string", "required": true },
        "name": { "type": "string", "required": true },
        "description": { "type": "string", "required": true },
        "icon": { "type": "string", "required": false },
        "color": { "type": "string", "required": false },
        "category": { "type": "string", "required": true },
        "rarity": { "type": "string", "required": true },
        "criteria": { "type": "object", "required": true },
        "rewards": { "type": "object", "required": false }
      },
      "securityRules": "allow read: if request.auth != null; allow write: if request.auth.token.isAdmin == true;"
    },
    "badge_progress": {
      "description": "User progress toward badges",
      "fields": {
        "userId": { "type": "string", "required": true },
        "badgeType": { "type": "string", "required": true },
        "progress": { "type": "number", "required": true },
        "currentValues": { "type": "object", "required": true },
        "requiredValues": { "type": "object", "required": true },
        "estimatedCompletion": { "type": "timestamp", "required": false }
      },
      "indexes": [
        { "fields": ["userId", "badgeType"], "description": "User badge progress" }
      ],
      "securityRules": "allow read: if request.auth.uid == resource.data.userId; allow write: if request.auth.uid == resource.data.userId || request.auth.token.isAdmin == true;"
    },
    "badge_statistics": {
      "description": "Aggregated badge statistics",
      "fields": {
        "totalBadgesIssued": { "type": "number", "required": true },
        "badgesByType": { "type": "object", "required": true },
        "averageBadgesPerUser": { "type": "number", "required": true },
        "topBadgeTypes": { "type": "array", "required": true },
        "monthlyIssuanceStats": { "type": "object", "required": false },
        "lastUpdated": { "type": "timestamp", "required": true }
      },
      "securityRules": "allow read: if request.auth != null; allow write: if request.auth.token.isAdmin == true;"
    },
    "workflow_state": {
      "description": "Workflow state tracking",
      "fields": {
        "jobId": { "type": "string", "required": true },
        "currentStep": { "type": "number", "required": true },
        "totalSteps": { "type": "number", "required": true },
        "completedSteps": { "type": "number", "required": true },
        "stepsRemaining": { "type": "number", "required": true },
        "nextSteps": { "type": "array", "required": true },
        "blockedSteps": { "type": "array", "required": false },
        "workflow": { "type": "object", "required": false },
        "createdAt": { "type": "timestamp", "required": true },
        "updatedAt": { "type": "timestamp", "required": true }
      },
      "indexes": [
        { "fields": ["jobId"], "description": "Workflow state retrieval" }
      ],
      "securityRules": "allow read: if request.auth.uid == get(/databases/$(database)/documents/jobs/$(resource.data.jobId)).data.userId; allow write: if request.auth.uid == get(/databases/$(database)/documents/jobs/$(resource.data.jobId)).data.userId;"
    },
    "job_monitoring": {
      "description": "Real-time job monitoring data",
      "fields": {
        "jobId": { "type": "string", "required": true },
        "status": { "type": "string", "required": true },
        "progress": { "type": "number", "required": true },
        "lastUpdated": { "type": "timestamp", "required": true },
        "estimatedCompletion": { "type": "timestamp", "required": false },
        "errors": { "type": "array", "required": false }
      },
      "indexes": [
        { "fields": ["jobId"], "description": "Job monitoring lookup" }
      ],
      "securityRules": "allow read: if request.auth.uid == get(/databases/$(database)/documents/jobs/$(resource.data.jobId)).data.userId; allow write: if request.auth.token.isAdmin == true;"
    },
    "job_progress": {
      "description": "Detailed job progress tracking",
      "fields": {
        "jobId": { "type": "string", "required": true },
        "totalFeatures": { "type": "number", "required": true },
        "completedFeatures": { "type": "number", "required": true },
        "skippedFeatures": { "type": "number", "required": true },
        "remainingFeatures": { "type": "number", "required": true },
        "progressPercentage": { "type": "number", "required": true },
        "currentFeature": { "type": "string", "required": false }
      },
      "indexes": [
        { "fields": ["jobId"], "description": "Job progress lookup" }
      ],
      "securityRules": "allow read: if request.auth.uid == get(/databases/$(database)/documents/jobs/$(resource.data.jobId)).data.userId; allow write: if request.auth.uid == get(/databases/$(database)/documents/jobs/$(resource.data.jobId)).data.userId;"
    },
    "user_subscriptions": {
      "description": "User subscription tier information",
      "fields": {
        "userId": { "type": "string", "required": true },
        "tier": { "type": "string", "required": true, "description": "Subscription tier (free, premium, enterprise)" },
        "startDate": { "type": "timestamp", "required": true },
        "endDate": { "type": "timestamp", "required": false },
        "isActive": { "type": "boolean", "required": true },
        "stripeCustomerId": { "type": "string", "required": false },
        "stripeSubscriptionId": { "type": "string", "required": false },
        "features": { "type": "object", "required": false, "description": "Feature access by tier" },
        "lastUpdated": { "type": "timestamp", "required": true }
      },
      "indexes": [
        { "fields": ["userId", "isActive"], "description": "Active subscription lookup" }
      ],
      "securityRules": "allow read: if request.auth.uid == resource.data.userId || request.auth.token.isAdmin == true; allow write: if request.auth.token.isAdmin == true;"
    },
    "feature_flags": {
      "description": "Feature flag configuration",
      "fields": {
        "NEW_FEATURE_ACCESS_LOGIC": { "type": "boolean", "required": true, "description": "Kill-switch for feature access control default-deny", "default": false },
        "lastUpdated": { "type": "timestamp", "required": true },
        "updatedBy": { "type": "string", "required": true }
      },
      "securityRules": "allow read: if request.auth != null; allow write: if request.auth.token.isAdmin == true;"
    }
  }
}
