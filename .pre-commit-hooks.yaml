# Pre-commit Hooks Definition for Mock Data Detection
# Author: Gil Klainert
# Created: 2025-01-08
# Version: 1.0.0
#
# This file defines custom hooks for the Olorin project's mock data detection system.
# These hooks can be reused across multiple repositories and projects.

hooks:
  # ============================================================================
  # Primary Mock Data Detection Hook
  # ============================================================================
  - id: detect-mock-data
    name: Enterprise Mock Data Detection
    description: 'Comprehensive mock/fake/placeholder data detection with zero tolerance policy'
    entry: scripts/git-hooks/detect-mock-data.py
    language: python
    language_version: python3.11
    minimum_pre_commit_version: '3.0.0'
    
    # File type associations
    types: [text]
    files: '.*'
    
    # Performance and behavior
    require_serial: true
    pass_filenames: false
    always_run: false
    
    # Hook arguments with sensible defaults
    args: [
      '--staged',
      '--fail-on', 'CRITICAL',
      '--config', 'scripts/git-hooks/mock-detection-config.yml'
    ]
    
    # Exclusion patterns for legitimate test files
    exclude: |
      (?x)^(
        # Test directories and files
        .*/(test|tests|spec|__tests__|cypress|e2e|integration)/.*|
        .*\.test\.(py|js|ts|jsx|tsx|java|rb|php|go|rs)$|
        .*\.spec\.(py|js|ts|jsx|tsx|java|rb|php|go|rs)$|
        .*_test\.(py|go)$|
        .*Test\.(java|kt|swift)$|
        
        # Build and dependency directories
        .*/node_modules/.*|
        .*/vendor/.*|
        .*/build/.*|
        .*/dist/.*|
        .*/__pycache__/.*|
        .*/\.tox/.*|
        .*/\.venv/.*|
        .*/venv/.*|
        .*/\.git/.*|
        
        # Generated and minified files
        .*\.min\.(js|css)$|
        .*\.bundle\.(js|css)$|
        .*\.generated\.(py|js|ts|java|go)$|
        .*\.pb\.(py|go|java)$|
        
        # Configuration templates and examples
        .*\.example$|
        .*\.template$|
        .*\.sample$|
        .*\.dist$|
        .*/examples/.*|
        .*/samples/.*|
        
        # Documentation directories
        .*/docs?/.*|
        .*/documentation/.*|
        .*README.*|
        .*CHANGELOG.*|
        .*LICENSE.*|
        
        # IDE and editor files
        .*\.idea/.*|
        .*\.vscode/.*|
        .*\.eclipse/.*|
        .*\.settings/.*|
        
        # Mock/test framework files (legitimate usage)
        .*jest\..*|
        .*sinon\..*|
        .*mocha\..*|
        .*unittest\..*|
        .*mockito\..*|
        .*testify\..*|
        
        # Configuration files for this system
        .*\.mockignore$|
        .*mock-detection-config\.ya?ml$|
        .*/\.pre-commit.*\.ya?ml$|
        .*\.pre-commit-hooks\.ya?ml$
      )
    
    # Supported stages
    stages: [commit, push, manual]

  # ============================================================================
  # Staged Files Only Hook (Optimized for Speed)
  # ============================================================================
  - id: detect-mock-data-staged
    name: Mock Data Detection (Staged Files Only)
    description: 'Fast mock data detection for staged files only (pre-commit optimization)'
    entry: scripts/git-hooks/detect-mock-data.py
    language: python
    language_version: python3.11
    
    types: [text]
    require_serial: true
    pass_filenames: false
    always_run: false
    
    args: [
      '--staged',
      '--fail-on', 'HIGH',
      '--quiet'
    ]
    
    exclude: |
      (?x)^(
        .*/(test|tests|spec|__tests__)/.*|
        .*\.test\.(py|js|ts|jsx|tsx)$|
        .*\.spec\.(py|js|ts|jsx|tsx)$|
        .*/node_modules/.*|
        .*/build/.*|
        .*/dist/.*
      )
    
    stages: [commit]

  # ============================================================================
  # Full Directory Scan Hook (Comprehensive Audit)
  # ============================================================================
  - id: detect-mock-data-full
    name: Mock Data Detection (Full Audit)
    description: 'Comprehensive mock data detection across entire repository'
    entry: scripts/git-hooks/detect-mock-data.py
    language: python
    language_version: python3.11
    
    types: [text]
    require_serial: true
    pass_filenames: false
    always_run: true
    
    args: [
      '--directory', '.',
      '--fail-on', 'MEDIUM',
      '--output-json', '.mock-detection-full-audit.json',
      '--verbose'
    ]
    
    exclude: |
      (?x)^(
        .*/(test|tests|spec|__tests__)/.*|
        .*/node_modules/.*|
        .*/build/.*|
        .*/dist/.*|
        .*/\.git/.*
      )
    
    stages: [manual, push]

  # ============================================================================
  # Configuration Validation Hook
  # ============================================================================
  - id: validate-mock-detection-config
    name: Mock Detection Config Validation
    description: 'Validate mock detection configuration files'
    entry: python
    language: system
    
    # Inline validation script
    args: ['-c', '
import sys
import yaml
from pathlib import Path

config_files = [
    "scripts/git-hooks/mock-detection-config.yml",
    ".mockignore"
]

exit_code = 0
for config_file in config_files:
    config_path = Path(config_file)
    if not config_path.exists():
        print(f"âš ï¸  Configuration file not found: {config_file}")
        continue
    
    try:
        if config_file.endswith(".yml") or config_file.endswith(".yaml"):
            with open(config_path, "r", encoding="utf-8") as f:
                yaml.safe_load(f)
            print(f"âœ… Valid YAML configuration: {config_file}")
        else:
            # Validate .mockignore format
            with open(config_path, "r", encoding="utf-8") as f:
                lines = f.readlines()
            print(f"âœ… Valid mockignore file: {config_file} ({len(lines)} patterns)")
    except Exception as e:
        print(f"âŒ Invalid configuration {config_file}: {e}")
        exit_code = 1

if exit_code == 0:
    print("ðŸŽ‰ All mock detection configurations are valid")
else:
    print("ðŸ’¥ Configuration validation failed")
    
sys.exit(exit_code)
    ']
    
    files: 'scripts/git-hooks/mock-detection-config\.ya?ml$|\.mockignore$'
    pass_filenames: false
    stages: [commit, manual]

  # ============================================================================
  # System Health Check Hook
  # ============================================================================
  - id: mock-detection-health-check
    name: Mock Detection System Health Check
    description: 'Verify mock detection system components and dependencies'
    entry: scripts/git-hooks/validate-system.py
    language: python
    language_version: python3.11
    
    require_serial: true
    pass_filenames: false
    always_run: true
    
    args: ['--quiet', '--essential-only']
    stages: [manual]

# ============================================================================
# Metadata and Documentation
# ============================================================================

# Repository metadata
author: Gil Klainert
author_email: gil.klainert@olorin.security
license: MIT
version: '1.0.0'

# Documentation links
documentation:
  - name: Mock Detection System Documentation
    url: docs/hooks/mock-detection-system.md
  - name: Configuration Guide
    url: docs/hooks/configuration-guide.md
  - name: Troubleshooting Guide
    url: docs/hooks/troubleshooting.md
  - name: Contributing Guidelines
    url: docs/hooks/contributing.md

# Integration requirements
requirements:
  python: ">=3.11"
  pre-commit: ">=3.0.0"
  
dependencies:
  - pyyaml>=6.0
  - pathspec>=0.11.0
  - jsonschema>=4.17.0

# Performance characteristics
performance:
  typical_execution_time: "< 10 seconds for 100 files"
  memory_usage: "< 50 MB for typical repositories"
  parallelization: "Multi-threaded file scanning (4 workers default)"
  incremental_support: true

# Quality and compliance
compliance:
  zero_tolerance_policy: true
  false_positive_rate: "< 0.1%"
  coverage: "100% of supported file types"
  languages_supported: 25+

# Support and maintenance
support:
  bug_reports: "Create issue in repository"
  feature_requests: "Create feature request issue"
  security_issues: "Contact security team directly"
  
maintenance:
  update_frequency: "Monthly pattern database updates"
  compatibility_testing: "Continuous integration"
  performance_monitoring: "Automated benchmarks"