```mermaid
graph TB
    Start([Start Migration Process]) --> Assessment[Security Assessment & Inventory]
    
    Assessment --> Prep{Pre-Migration<br/>Preparation}
    Prep --> Backup[Create Secure Backups]
    Prep --> IAM[Configure IAM Roles]
    Prep --> Training[Team Training]
    
    Backup --> FirebaseSetup[Firebase Secret<br/>Manager Setup]
    IAM --> FirebaseSetup
    Training --> FirebaseSetup
    
    FirebaseSetup --> ProjectConfig[Configure olorin-ai Project]
    ProjectConfig --> SecretCreate[Create Secrets Structure]
    
    SecretCreate --> Migration{Migration<br/>Phases}
    
    Migration --> Dev[Development Environment]
    Dev --> DevServer[olorin-server Dev]
    Dev --> DevFront[olorin-front Dev]
    Dev --> DevPortal[olorin-web-portal Dev]
    
    DevServer --> DevTest{Dev Testing}
    DevFront --> DevTest
    DevPortal --> DevTest
    
    DevTest -->|Pass| Staging[Staging Environment]
    DevTest -->|Fail| DevRollback[Dev Rollback]
    DevRollback --> Dev
    
    Staging --> StagingServer[olorin-server Staging]
    Staging --> StagingFront[olorin-front Staging]
    Staging --> StagingPortal[olorin-web-portal Staging]
    
    StagingServer --> StagingTest{Staging Testing}
    StagingFront --> StagingTest
    StagingPortal --> StagingTest
    
    StagingTest -->|Pass| Prod[Production Environment]
    StagingTest -->|Fail| StagingRollback[Staging Rollback]
    StagingRollback --> Staging
    
    Prod --> ProdServer[olorin-server Prod]
    Prod --> ProdFront[olorin-front Prod]
    Prod --> ProdPortal[olorin-web-portal Prod]
    Prod --> ProdDocker[Docker Environment]
    
    ProdServer --> ProdTest{Production<br/>Validation}
    ProdFront --> ProdTest
    ProdPortal --> ProdTest
    ProdDocker --> ProdTest
    
    ProdTest -->|Pass| PostMigration[Post-Migration Tasks]
    ProdTest -->|Fail| ProdRollback[Emergency Rollback]
    ProdRollback --> RestoreEnv[Restore .env Files]
    RestoreEnv --> ServiceRestart[Restart Services]
    ServiceRestart --> IncidentReview[Incident Review]
    
    PostMigration --> Cleanup[Environment File Cleanup]
    PostMigration --> GitClean[Git History Cleaning]
    PostMigration --> AccessReview[Access Control Review]
    PostMigration --> Monitoring[Setup Monitoring]
    
    Cleanup --> Complete([Migration Complete])
    GitClean --> Complete
    AccessReview --> Complete
    Monitoring --> Complete
    
    style Start fill:#e1f5e1
    style Complete fill:#e1f5e1
    style DevRollback fill:#ffe0e0
    style StagingRollback fill:#ffe0e0
    style ProdRollback fill:#ffe0e0
    style DevTest fill:#fff4e0
    style StagingTest fill:#fff4e0
    style ProdTest fill:#fff4e0
```

```mermaid
sequenceDiagram
    participant Dev as Developer
    participant Local as Local Environment
    participant Firebase as Firebase Secret Manager
    participant CI as CI/CD Pipeline
    participant App as Application
    
    Note over Dev,App: Secret Creation Phase
    Dev->>Firebase: Create secret via gcloud CLI
    Firebase-->>Dev: Secret created confirmation
    
    Note over Dev,App: Development Phase
    Dev->>Local: Run application locally
    Local->>Local: Check for env variables
    alt Environment variable exists
        Local-->>App: Use local env variable
    else No environment variable
        Local->>Firebase: Request secret value
        Firebase-->>Local: Return secret value
        Local-->>App: Use Firebase secret
    end
    
    Note over Dev,App: CI/CD Deployment Phase
    Dev->>CI: Push code to repository
    CI->>Firebase: Authenticate with service account
    Firebase-->>CI: Authentication successful
    CI->>Firebase: Request deployment secrets
    Firebase-->>CI: Return secret values
    CI->>App: Deploy with secrets injected
    
    Note over Dev,App: Runtime Phase
    App->>App: Initialize with cached secrets
    App->>Firebase: Periodic secret refresh
    Firebase-->>App: Updated secret values
    App->>App: Update cached values
    
    Note over Dev,App: Secret Rotation
    Dev->>Firebase: Update secret value
    Firebase-->>Dev: Secret updated
    Firebase->>App: Notify of secret change
    App->>Firebase: Fetch new secret value
    Firebase-->>App: Return new value
    App->>App: Update application config
```

```mermaid
stateDiagram-v2
    [*] --> Assessment: Start Migration
    
    Assessment --> Preparation: Complete Assessment
    
    Preparation --> BackupCreation: Prepare Infrastructure
    BackupCreation --> IAMConfiguration: Backups Complete
    IAMConfiguration --> TeamTraining: IAM Configured
    TeamTraining --> FirebaseSetup: Training Complete
    
    FirebaseSetup --> SecretCreation: Firebase Ready
    
    SecretCreation --> DevMigration: Secrets Created
    
    DevMigration --> DevTesting: Code Updated
    DevTesting --> StagingMigration: Tests Pass
    DevTesting --> DevRollback: Tests Fail
    DevRollback --> DevMigration: Fix Issues
    
    StagingMigration --> StagingTesting: Deploy to Staging
    StagingTesting --> ProdMigration: Tests Pass
    StagingTesting --> StagingRollback: Tests Fail
    StagingRollback --> StagingMigration: Fix Issues
    
    ProdMigration --> ProdValidation: Deploy to Production
    ProdValidation --> PostMigration: Validation Pass
    ProdValidation --> EmergencyRollback: Validation Fail
    EmergencyRollback --> IncidentReview: Services Restored
    IncidentReview --> StagingMigration: Retry Migration
    
    PostMigration --> Cleanup: Migration Success
    Cleanup --> Monitoring: Files Cleaned
    Monitoring --> [*]: Migration Complete
    
    note right of Assessment
        Identify all secrets
        Document dependencies
        Assess risks
    end note
    
    note right of FirebaseSetup
        Configure olorin-ai project
        Set up IAM roles
        Create secret structure
    end note
    
    note right of ProdMigration
        Zero-downtime deployment
        Blue-green strategy
        Gradual rollout
    end note
    
    note right of EmergencyRollback
        Restore .env files
        Restart services
        Verify health
    end note
```

```mermaid
graph LR
    subgraph "Current State"
        EnvFiles[.env Files]
        LocalSecrets[Local Secrets]
        GitHistory[Git History<br/>with Secrets]
    end
    
    subgraph "Migration Process"
        Scanner[Secret Scanner]
        Categorizer[Secret Categorizer]
        Creator[Secret Creator]
        Updater[Code Updater]
        Tester[Test Suite]
    end
    
    subgraph "Target State"
        Firebase[Firebase Secret Manager]
        IAM[IAM Roles]
        Audit[Audit Logs]
        Rotation[Auto Rotation]
    end
    
    subgraph "Applications"
        Server[olorin-server]
        Front[olorin-front]
        Portal[olorin-web-portal]
        Docker[Docker Environment]
    end
    
    EnvFiles --> Scanner
    LocalSecrets --> Scanner
    GitHistory --> Scanner
    
    Scanner --> Categorizer
    Categorizer --> Creator
    Creator --> Firebase
    
    Firebase --> IAM
    IAM --> Audit
    Firebase --> Rotation
    
    Updater --> Server
    Updater --> Front
    Updater --> Portal
    Updater --> Docker
    
    Server --> Tester
    Front --> Tester
    Portal --> Tester
    Docker --> Tester
    
    Tester -->|Success| Firebase
    Tester -->|Failure| Updater
    
    style EnvFiles fill:#ffe0e0
    style LocalSecrets fill:#ffe0e0
    style GitHistory fill:#ffe0e0
    style Firebase fill:#e1f5e1
    style IAM fill:#e1f5e1
    style Audit fill:#e1f5e1
    style Rotation fill:#e1f5e1
```