[1m============================= test session starts ==============================[0m
platform darwin -- Python 3.11.12, pytest-8.3.5, pluggy-1.5.0
rootdir: /Users/gklainert/Documents/gaia
configfile: pyproject.toml
plugins: anyio-4.9.0, mock-3.14.0, cov-6.1.1, asyncio-1.0.0, xdist-3.6.1, langsmith-0.3.33
asyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
collected 328 items / 1 skipped

app/test/adapters/test_upi_client.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[33m                             [  2%][0m
app/test/integration/test_auth.py [32m.[0m[32m.[0m[32m.[0m[33m                                    [  3%][0m
app/test/integration/test_endpoints.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[33m               [  8%][0m
app/test/unit/persistence/test_async_ips_redis.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[33m           [ 12%][0m
app/test/unit/router/test_agent_router.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31mF[0m[32m.[0m[32m.[0m[32m.[0m[31m           [ 18%][0m
app/test/unit/router/test_agent_router_helper.py [32m.[0m[31m                       [ 18%][0m
app/test/unit/router/test_device_router.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m [ 27%]
[0m[32m.[0m[31m                                                                        [ 28%][0m
app/test/unit/router/test_location_router.py [32m.[0m[32m.[0m[32m.[0m[31m                         [ 28%][0m
app/test/unit/router/test_logs_router.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                         [ 31%][0m
app/test/unit/router/test_network_router.py [32m.[0m[32m.[0m[32m.[0m[31m                          [ 32%][0m
app/test/unit/service/agent/test_agent.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                           [ 33%][0m
app/test/unit/service/agent/test_kk_dash_client.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m             [ 35%][0m
app/test/unit/service/agent/test_location_data_agent.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m [ 40%]
[0m[32m.[0m[32m.[0m[32m.[0m[31m                                                                      [ 41%][0m
app/test/unit/service/agent/test_location_data_client.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m [ 46%]
[0m[31m                                                                         [ 46%][0m
app/test/unit/service/agent/test_splunk_agent.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m              [ 49%][0m
app/test/unit/service/agent/test_splunk_client.py [31mF[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31m        [ 53%][0m
app/test/unit/service/agent/test_tmx_client.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                      [ 55%][0m
app/test/unit/service/agent/tools/cdc_tool/test_cdc_tool.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m  [ 58%][0m
app/test/unit/service/agent/tools/qb_tool/test_customer_tools.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m  [ 60%][0m
app/test/unit/service/agent/tools/qb_tool/test_qbo_service.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m [ 63%]
[0m[32m.[0m[31m                                                                        [ 63%][0m
app/test/unit/service/agent/tools/retriever_tool/test_retriever_tool.py [32m.[0m[31m [ 64%]
[0m[31m                                                                         [ 64%][0m
app/test/unit/service/agent/tools/test_di_tool.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                   [ 65%][0m
app/test/unit/service/agent/tools/test_vector_search_tool.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m [ 68%]
[0m[32m.[0m[32m.[0m[31m                                                                       [ 69%][0m
app/test/unit/service/test_agent_service.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                       [ 71%][0m
app/test/unit/service/test_init.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                          [ 74%][0m
app/test/unit/test_something.py [32m.[0m[31m                                        [ 75%][0m
app/test/unit/utils/test_auth_utils.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m     [ 83%][0m
app/test/unit/utils/test_class_utils.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                [ 89%][0m
app/test/unit/utils/test_idps_utils.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                            [ 90%][0m
app/test/unit/utils/test_logging.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                                 [ 92%][0m
app/test/unit/utils/test_prompt_utils.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m              [ 97%][0m
tests/test_location_api_integration.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                              [ 98%][0m
tests/test_location_client_vector_search.py [32m.[0m[32m.[0m[31m                           [ 99%][0m
tests/test_vector_search_simple.py [32m.[0m[32m.[0m[31m                                    [100%][0m

=================================== FAILURES ===================================
[31m[1m___________________ test_get_location_risk_analysis_success ____________________[0m

client = <starlette.testclient.TestClient object at 0x194293390>

    [0m[94mdef[39;49;00m[90m [39;49;00m[92mtest_get_location_risk_analysis_success[39;49;00m(client):[90m[39;49;00m
        [94mwith[39;49;00m ([90m[39;49;00m
            patch([90m[39;49;00m
                [33m"[39;49;00m[33mapp.service.agent.ato_agents.location_data_agent.client.LocationDataClient.get_oii_location_info[39;49;00m[33m"[39;49;00m,[90m[39;49;00m
                return_value={[33m"[39;49;00m[33msource[39;49;00m[33m"[39;49;00m: [33m"[39;49;00m[33mOII[39;49;00m[33m"[39;49;00m},[90m[39;49;00m
            ),[90m[39;49;00m
            patch([90m[39;49;00m
                [33m"[39;49;00m[33mapp.service.agent.ato_agents.location_data_agent.client.LocationDataClient.get_salesforce_location_info[39;49;00m[33m"[39;49;00m,[90m[39;49;00m
                return_value={[33m"[39;49;00m[33msource[39;49;00m[33m"[39;49;00m: [33m"[39;49;00m[33mSalesforce[39;49;00m[33m"[39;49;00m},[90m[39;49;00m
            ),[90m[39;49;00m
            patch([90m[39;49;00m
                [33m"[39;49;00m[33mapp.service.agent.ato_agents.location_data_agent.client.LocationDataClient.get_ekata_location_info[39;49;00m[33m"[39;49;00m,[90m[39;49;00m
                return_value={[33m"[39;49;00m[33msource[39;49;00m[33m"[39;49;00m: [33m"[39;49;00m[33mEkata[39;49;00m[33m"[39;49;00m},[90m[39;49;00m
            ),[90m[39;49;00m
            patch([90m[39;49;00m
                [33m"[39;49;00m[33mapp.service.agent.ato_agents.location_data_agent.client.LocationDataClient.get_business_location_info[39;49;00m[33m"[39;49;00m,[90m[39;49;00m
                return_value={[33m"[39;49;00m[33msource[39;49;00m[33m"[39;49;00m: [33m"[39;49;00m[33mBusiness[39;49;00m[33m"[39;49;00m},[90m[39;49;00m
            ),[90m[39;49;00m
            patch([90m[39;49;00m
                [33m"[39;49;00m[33mapp.service.agent.ato_agents.location_data_agent.client.LocationDataClient.get_phone_location_info[39;49;00m[33m"[39;49;00m,[90m[39;49;00m
                return_value={[33m"[39;49;00m[33msource[39;49;00m[33m"[39;49;00m: [33m"[39;49;00m[33mPhone[39;49;00m[33m"[39;49;00m},[90m[39;49;00m
            ),[90m[39;49;00m
            patch([33m"[39;49;00m[33mapp.router.device_router.analyze_device[39;49;00m[33m"[39;49;00m, return_value=[94mNone[39;49;00m),[90m[39;49;00m
            patch([90m[39;49;00m
                [33m"[39;49;00m[33mapp.router.api_router.ainvoke_agent[39;49;00m[33m"[39;49;00m,[90m[39;49;00m
                return_value=([90m[39;49;00m
                    json.dumps([90m[39;49;00m
                        {[90m[39;49;00m
                            [33m"[39;49;00m[33mrisk_assessment[39;49;00m[33m"[39;49;00m: {[90m[39;49;00m
                                [33m"[39;49;00m[33mrisk_level[39;49;00m[33m"[39;49;00m: [94m0.1[39;49;00m,[90m[39;49;00m
                                [33m"[39;49;00m[33mrisk_factors[39;49;00m[33m"[39;49;00m: [[33m"[39;49;00m[33mtest[39;49;00m[33m"[39;49;00m],[90m[39;49;00m
                                [33m"[39;49;00m[33mconfidence[39;49;00m[33m"[39;49;00m: [94m0.9[39;49;00m,[90m[39;49;00m
                                [33m"[39;49;00m[33msummary[39;49;00m[33m"[39;49;00m: [33m"[39;49;00m[33mok[39;49;00m[33m"[39;49;00m,[90m[39;49;00m
                                [33m"[39;49;00m[33mthoughts[39;49;00m[33m"[39;49;00m: [33m"[39;49;00m[33mnone[39;49;00m[33m"[39;49;00m,[90m[39;49;00m
                            }[90m[39;49;00m
                        }[90m[39;49;00m
                    ),[90m[39;49;00m
                    [94mNone[39;49;00m,[90m[39;49;00m
                ),[90m[39;49;00m
            ),[90m[39;49;00m
        ):[90m[39;49;00m
            response = client.get([90m[39;49;00m
                [33m"[39;49;00m[33m/api/location/risk-analysis/testuser?investigation_id=inv1[39;49;00m[33m"[39;49;00m[90m[39;49;00m
            )[90m[39;49;00m
>           [94massert[39;49;00m response.status_code == [94m200[39;49;00m[90m[39;49;00m
[1m[31mE           assert 500 == 200[0m
[1m[31mE            +  where 500 = <Response [500 Internal Server Error]>.status_code[0m

[1m[31mapp/test/unit/router/test_agent_router.py[0m:293: AssertionError
----------------------------- Captured stdout call -----------------------------
Authorization header: None
----------------------------- Captured stderr call -----------------------------
[2025-06-01T17:05:04-0400] DEBUG [] module=selector_events: Using selector: KqueueSelector
[2025-06-01T17:05:04-0400] INFO [] module=api_router: Starting location risk analysis for user testuser
[2025-06-01T17:05:04-0400] DEBUG [] module=device_router: [DEMO CHECK] user_id=testuser in demo_mode_users=False, in demo_cache=False, cache keys=None
[2025-06-01T17:05:04-0400] ERROR [] module=device_router: Splunk operation failed for user testuser: Login failed.
Traceback (most recent call last):
  File "/Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/splunklib/binding.py", line 946, in login
    response = self.http.post(
               ^^^^^^^^^^^^^^^
  File "/Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/splunklib/binding.py", line 1315, in post
    return self.request(url, message)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/splunklib/binding.py", line 1344, in request
    raise HTTPError(response)
splunklib.binding.HTTPError: HTTP 401 Unauthorized -- Login failed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/gklainert/Documents/gaia/app/router/device_router.py", line 145, in analyze_device
    await splunk_client.connect()
  File "/Users/gklainert/Documents/gaia/app/service/agent/ato_agents/splunk_agent/client.py", line 43, in connect
    await asyncio.get_event_loop().run_in_executor(self._executor, _connect)
  File "/usr/local/Cellar/python@3.11/3.11.12_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gklainert/Documents/gaia/app/service/agent/ato_agents/splunk_agent/client.py", line 36, in _connect
    self.service = splunk.connect(
                   ^^^^^^^^^^^^^^^
  File "/Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/splunklib/client.py", line 339, in connect
    s.login()
  File "/Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/splunklib/binding.py", line 959, in login
    raise AuthenticationError("Login failed.", he)
splunklib.binding.AuthenticationError: Login failed.
[2025-06-01T17:05:04-0400] INFO [] module=chronos_tool: Got auth tokens - userid: 9130360342..., realmid: 123145964165782
[2025-06-01T17:05:04-0400] DEBUG [] module=chronos_tool: Making Chronos API request for user testuser with payload: {"metadata": {"limit": 300}, "range": {"from": "2025-05-02T21:05:04+00:00", "to": "2025-06-01T21:05:04+00:00"}, "filter": {"auth_id": ["testuser"]}, "select": ["os", "osVersion", "trueIpCity", "trueIpGeo", "ts", "kdid", "smartId", "offeringId", "trueIpFirstSeen", "trueIpRegion", "trueIpLatitude", "trueIpLongitude", "agentType", "browserString", "fuzzyDeviceFirstSeen", "timezone", "tmResponse.tmxReasonCodes", "sessionId"], "queryId": "GAIA", "routingLabel": "elc"}
[2025-06-01T17:05:04-0400] DEBUG [] module=chronos_tool: Request headers: {'olorin_originatingip': '127.0.0.1', 'olorin_country': 'US', 'olorin_locale': 'en-US', 'Content-Type': 'application/json', 'Accept': 'application/json', 'olorin_assetalias': 'Olorin.cas.hri.gaia', 'olorin_offeringid': 'Olorin.cto.iam.ius', 'olorin_tid': '480e8643-d4fb-4546-bda8-555c67c14432', 'Authorization': 'Olorin_IAM_Authentication olorin_realmid=123145964...'}
[2025-06-01T17:05:05-0400] INFO [] module=chronos_tool: Chronos API response status: 200
[2025-06-01T17:05:05-0400] DEBUG [] module=chronos_tool: Chronos API response data: {"metadata":{"limit":300,"entitiesCount":0,"totalCount":0},"entities":[]}
[2025-06-01T17:05:05-0400] DEBUG [] module=device_router: Chronos response structure check failed for user testuser:
[2025-06-01T17:05:05-0400] DEBUG [] module=device_router:   - chronos_response_dict exists: True
[2025-06-01T17:05:05-0400] DEBUG [] module=device_router:   - is dict: True
[2025-06-01T17:05:05-0400] DEBUG [] module=device_router:   - has 'entities' key: True
[2025-06-01T17:05:05-0400] DEBUG [] module=device_router:   - entities value: []
[2025-06-01T17:05:05-0400] WARNING [] module=device_router: No sessionId found in Chronos response for user testuser. DI Tool will not be called.
[2025-06-01T17:05:05-0400] DEBUG [] module=connectionpool: Starting new HTTPS connection (1): identityinternal-e2e.api.olorin.com:443
[2025-06-01T17:05:08-0400] DEBUG [] module=connectionpool: https://identityinternal-e2e.api.olorin.com:443 "POST /signin/graphql HTTP/1.1" 401 0
[2025-06-01T17:05:08-0400] ERROR [] module=auth_utils: Identity service returned status 401: 
[2025-06-01T17:05:08-0400] ERROR [] module=auth_utils: Failed to get authentication token: Identity service authentication failed with status 401
[2025-06-01T17:05:08-0400] INFO [] module=device_router: Invoking LLM for device risk assessment for user testuser
[2025-06-01T17:05:08-0400] DEBUG [] module=agent_service: Invoking LangGraph with agent_context={
    "id": "ed5b678b-9764-481f-bf2d-a47bce4d7fa4",
    "olorin_header": {
        "olorin_tid": "gaia-device-risk-testuser",
        "olorin_experience_id": "d3d28eaa-7ca9-4aa2-8905-69ac11fd8c58",
        "olorin_originating_assetalias": "Olorin.cas.hri.gaia"
    },
    "query_params": {},
    "start_time": 1748811908.1870599,
    "input": "You are a security analyst specializing in device-based risk assessment.\nWhen making your risk assessment, prioritize the information in the user chat history if it is relevant.\nBased on the provided device signal data for a user, analyze all available information.\nThe data includes IP address, geo-location (city, country, region), timestamps, and device ID.\nYour response MUST be a JSON object strictly conforming to the following Pydantic model schema:\n{\"properties\": {\"risk_level\": {\"description\": \"A score between 0.0 (low risk) and 1.0 (high risk) based on device signals.\", \"title\": \"Risk Level\", \"type\": \"number\"}, \"risk_factors\": {\"description\": \"Specific device-related factors contributing to the risk (e.g., ISP inconsistency, geo-anomaly, VPN detected from device logs).\", \"items\": {\"type\": \"string\"}, \"title\": \"Risk Factors\", \"type\": \"array\"}, \"anomaly_details\": {\"description\": \"Details of any specific anomalies detected, e.g., 'Device used from US and IN within short period'.\", \"items\": {\"type\": \"string\"}, \"title\": \"Anomaly Details\", \"type\": \"array\"}, \"confidence\": {\"description\": \"LLM's confidence in this device signal assessment (0.0 to 1.0)\", \"title\": \"Confidence\", \"type\": \"number\"}, \"summary\": {\"description\": \"LLM's summary of device signal risk.\", \"title\": \"Summary\", \"type\": \"string\"}, \"thoughts\": {\"description\": \"Detailed analysis and insights about the device risk assessment, including potential implications and patterns observed.\", \"title\": \"Thoughts\", \"type\": \"string\"}, \"timestamp\": {\"title\": \"Timestamp\", \"type\": \"string\"}}, \"required\": [\"risk_level\", \"risk_factors\", \"confidence\", \"summary\", \"thoughts\"], \"title\": \"DeviceSignalRiskLLMAssessment\", \"type\": \"object\"}\n\nCRITICAL ANALYSIS REQUIREMENTS:\n1. Geographic Analysis:\n   - Analyze ALL device locations, not just the most recent ones\n   - Flag ANY geographic conflicts between devices\n   - Consider the distance and time between location changes\n   - Pay special attention to international access patterns\n\n2. Device Pattern Analysis:\n   - Identify all unique devices used\n   - Note any unusual device switching patterns\n   - Consider the frequency of device changes\n\n3. Risk Scoring Guidelines:\n   - HIGH RISK (0.7-1.0): Multiple devices from different countries, especially if one is international\n   - MEDIUM RISK (0.4-0.6): Multiple devices from same country but different regions\n   - LOW RISK (0.0-0.3): Single device or multiple devices from same region\n\nIMPORTANT: Base your risk score and risk factors PRIMARILY on geographic inconsistencies and device ID patterns.\nMention ALL significant geographic anomalies in 'anomaly_details'.\nEnsure all fields in the JSON response are populated.\nIf no device signals are provided, indicate that in the summary and assign a low risk/confidence.\nThe input data is as follows:\n{\n  \"user_id\": \"testuser\",\n  \"retrieved_signals\": [],\n  \"oii_country\": null,\n  \"num_device_signals\": 0\n}",
    "metadata": {
        "interaction_id": null,
        "experience_id": null,
        "originating_asset_alias": null,
        "olorin_tid": null,
        "agent": null,
        "additional_metadata": null,
        "supported_output_formats": null,
        "interaction_group_id": null
    },
    "agent_name": "Olorin.cas.hri.gaia:device-risk-analyzer",
    "session_id": null,
    "thread_id": "None-d3d28eaa-7ca9-4aa2-8905-69ac11fd8c58"
} with enable_langfuse=True
[2025-06-01T17:05:08-0400] INFO [] module=agent_service: Invoking LangGraph with enable_langfuse=True
[2025-06-01T17:05:08-0400] ERROR [] module=agent_service: Unknown Error: 'State' object has no attribute 'graph'
Traceback (most recent call last):
  File "/Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/starlette/datastructures.py", line 668, in __getattr__
    return self._state[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'graph'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/gklainert/Documents/gaia/app/service/agent_service.py", line 68, in ainvoke_agent
    result = await request.app.state.graph.ainvoke(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/starlette/datastructures.py", line 671, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'graph'
[2025-06-01T17:05:08-0400] ERROR [] module=device_router: LLM invocation or validation error for device risk for testuser: 'State' object has no attribute 'graph'
Traceback (most recent call last):
  File "/Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/starlette/datastructures.py", line 668, in __getattr__
    return self._state[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'graph'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/gklainert/Documents/gaia/app/service/agent_service.py", line 68, in ainvoke_agent
    result = await request.app.state.graph.ainvoke(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/starlette/datastructures.py", line 671, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'graph'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/gklainert/Documents/gaia/app/router/device_router.py", line 439, in analyze_device
    raw_llm_response_str, _ = await ainvoke_agent(
                              ^^^^^^^^^^^^^^^^^^^^
  File "/Users/gklainert/Documents/gaia/app/service/agent_service.py", line 90, in ainvoke_agent
    raise AgentInvokeException(ex)
app.service.error_handling.AgentInvokeException: 'State' object has no attribute 'graph'
[2025-06-01T17:05:08-0400] ERROR [] module=api_router: Error in get_location_risk_analysis for user testuser: 'dict' object has no attribute 'raw_splunk_results'
Traceback (most recent call last):
  File "/Users/gklainert/Documents/gaia/app/router/api_router.py", line 597, in get_location_risk_analysis
    and processed_device_data.raw_splunk_results  # Access its raw_splunk_results
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute 'raw_splunk_results'
------------------------------ Captured log call -------------------------------
[35mDEBUG   [0m asyncio:selector_events.py:54 Using selector: KqueueSelector
[32mINFO    [0m app.router.api_router:api_router.py:466 Starting location risk analysis for user testuser
[35mDEBUG   [0m app.router.device_router:device_router.py:95 [DEMO CHECK] user_id=testuser in demo_mode_users=False, in demo_cache=False, cache keys=None
[31m[1mERROR   [0m app.router.device_router:device_router.py:157 Splunk operation failed for user testuser: Login failed.
Traceback (most recent call last):
  File "/Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/splunklib/binding.py", line 946, in login
    response = self.http.post(
               ^^^^^^^^^^^^^^^
  File "/Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/splunklib/binding.py", line 1315, in post
    return self.request(url, message)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/splunklib/binding.py", line 1344, in request
    raise HTTPError(response)
splunklib.binding.HTTPError: HTTP 401 Unauthorized -- Login failed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/gklainert/Documents/gaia/app/router/device_router.py", line 145, in analyze_device
    await splunk_client.connect()
  File "/Users/gklainert/Documents/gaia/app/service/agent/ato_agents/splunk_agent/client.py", line 43, in connect
    await asyncio.get_event_loop().run_in_executor(self._executor, _connect)
  File "/usr/local/Cellar/python@3.11/3.11.12_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/concurrent/futures/thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gklainert/Documents/gaia/app/service/agent/ato_agents/splunk_agent/client.py", line 36, in _connect
    self.service = splunk.connect(
                   ^^^^^^^^^^^^^^^
  File "/Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/splunklib/client.py", line 339, in connect
    s.login()
  File "/Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/splunklib/binding.py", line 959, in login
    raise AuthenticationError("Login failed.", he)
splunklib.binding.AuthenticationError: Login failed.
[32mINFO    [0m app.service.agent.tools.chronos_tool.chronos_tool:chronos_tool.py:96 Got auth tokens - userid: 9130360342..., realmid: 123145964165782
[35mDEBUG   [0m app.service.agent.tools.chronos_tool.chronos_tool:chronos_tool.py:143 Making Chronos API request for user testuser with payload: {"metadata": {"limit": 300}, "range": {"from": "2025-05-02T21:05:04+00:00", "to": "2025-06-01T21:05:04+00:00"}, "filter": {"auth_id": ["testuser"]}, "select": ["os", "osVersion", "trueIpCity", "trueIpGeo", "ts", "kdid", "smartId", "offeringId", "trueIpFirstSeen", "trueIpRegion", "trueIpLatitude", "trueIpLongitude", "agentType", "browserString", "fuzzyDeviceFirstSeen", "timezone", "tmResponse.tmxReasonCodes", "sessionId"], "queryId": "GAIA", "routingLabel": "elc"}
[35mDEBUG   [0m app.service.agent.tools.chronos_tool.chronos_tool:chronos_tool.py:146 Request headers: {'olorin_originatingip': '127.0.0.1', 'olorin_country': 'US', 'olorin_locale': 'en-US', 'Content-Type': 'application/json', 'Accept': 'application/json', 'olorin_assetalias': 'Olorin.cas.hri.gaia', 'olorin_offeringid': 'Olorin.cto.iam.ius', 'olorin_tid': '480e8643-d4fb-4546-bda8-555c67c14432', 'Authorization': 'Olorin_IAM_Authentication olorin_realmid=123145964...'}
[32mINFO    [0m app.service.agent.tools.chronos_tool.chronos_tool:chronos_tool.py:154 Chronos API response status: 200
[35mDEBUG   [0m app.service.agent.tools.chronos_tool.chronos_tool:chronos_tool.py:155 Chronos API response data: {"metadata":{"limit":300,"entitiesCount":0,"totalCount":0},"entities":[]}
[35mDEBUG   [0m app.router.device_router:device_router.py:339 Chronos response structure check failed for user testuser:
[35mDEBUG   [0m app.router.device_router:device_router.py:340   - chronos_response_dict exists: True
[35mDEBUG   [0m app.router.device_router:device_router.py:343   - is dict: True
[35mDEBUG   [0m app.router.device_router:device_router.py:345   - has 'entities' key: True
[35mDEBUG   [0m app.router.device_router:device_router.py:348   - entities value: []
[33mWARNING [0m app.router.device_router:device_router.py:364 No sessionId found in Chronos response for user testuser. DI Tool will not be called.
[35mDEBUG   [0m urllib3.connectionpool:connectionpool.py:1049 Starting new HTTPS connection (1): identityinternal-e2e.api.olorin.com:443
[35mDEBUG   [0m urllib3.connectionpool:connectionpool.py:544 https://identityinternal-e2e.api.olorin.com:443 "POST /signin/graphql HTTP/1.1" 401 0
[31m[1mERROR   [0m app.utils.auth_utils:auth_utils.py:89 Identity service returned status 401: 
[31m[1mERROR   [0m app.utils.auth_utils:auth_utils.py:137 Failed to get authentication token: Identity service authentication failed with status 401
[32mINFO    [0m app.router.device_router:device_router.py:436 Invoking LLM for device risk assessment for user testuser
[35mDEBUG   [0m app.service.agent_service:agent_service.py:60 Invoking LangGraph with agent_context={
    "id": "ed5b678b-9764-481f-bf2d-a47bce4d7fa4",
    "olorin_header": {
        "olorin_tid": "gaia-device-risk-testuser",
        "olorin_experience_id": "d3d28eaa-7ca9-4aa2-8905-69ac11fd8c58",
        "olorin_originating_assetalias": "Olorin.cas.hri.gaia"
    },
    "query_params": {},
    "start_time": 1748811908.1870599,
    "input": "You are a security analyst specializing in device-based risk assessment.\nWhen making your risk assessment, prioritize the information in the user chat history if it is relevant.\nBased on the provided device signal data for a user, analyze all available information.\nThe data includes IP address, geo-location (city, country, region), timestamps, and device ID.\nYour response MUST be a JSON object strictly conforming to the following Pydantic model schema:\n{\"properties\": {\"risk_level\": {\"description\": \"A score between 0.0 (low risk) and 1.0 (high risk) based on device signals.\", \"title\": \"Risk Level\", \"type\": \"number\"}, \"risk_factors\": {\"description\": \"Specific device-related factors contributing to the risk (e.g., ISP inconsistency, geo-anomaly, VPN detected from device logs).\", \"items\": {\"type\": \"string\"}, \"title\": \"Risk Factors\", \"type\": \"array\"}, \"anomaly_details\": {\"description\": \"Details of any specific anomalies detected, e.g., 'Device used from US and IN within short period'.\", \"items\": {\"type\": \"string\"}, \"title\": \"Anomaly Details\", \"type\": \"array\"}, \"confidence\": {\"description\": \"LLM's confidence in this device signal assessment (0.0 to 1.0)\", \"title\": \"Confidence\", \"type\": \"number\"}, \"summary\": {\"description\": \"LLM's summary of device signal risk.\", \"title\": \"Summary\", \"type\": \"string\"}, \"thoughts\": {\"description\": \"Detailed analysis and insights about the device risk assessment, including potential implications and patterns observed.\", \"title\": \"Thoughts\", \"type\": \"string\"}, \"timestamp\": {\"title\": \"Timestamp\", \"type\": \"string\"}}, \"required\": [\"risk_level\", \"risk_factors\", \"confidence\", \"summary\", \"thoughts\"], \"title\": \"DeviceSignalRiskLLMAssessment\", \"type\": \"object\"}\n\nCRITICAL ANALYSIS REQUIREMENTS:\n1. Geographic Analysis:\n   - Analyze ALL device locations, not just the most recent ones\n   - Flag ANY geographic conflicts between devices\n   - Consider the distance and time between location changes\n   - Pay special attention to international access patterns\n\n2. Device Pattern Analysis:\n   - Identify all unique devices used\n   - Note any unusual device switching patterns\n   - Consider the frequency of device changes\n\n3. Risk Scoring Guidelines:\n   - HIGH RISK (0.7-1.0): Multiple devices from different countries, especially if one is international\n   - MEDIUM RISK (0.4-0.6): Multiple devices from same country but different regions\n   - LOW RISK (0.0-0.3): Single device or multiple devices from same region\n\nIMPORTANT: Base your risk score and risk factors PRIMARILY on geographic inconsistencies and device ID patterns.\nMention ALL significant geographic anomalies in 'anomaly_details'.\nEnsure all fields in the JSON response are populated.\nIf no device signals are provided, indicate that in the summary and assign a low risk/confidence.\nThe input data is as follows:\n{\n  \"user_id\": \"testuser\",\n  \"retrieved_signals\": [],\n  \"oii_country\": null,\n  \"num_device_signals\": 0\n}",
    "metadata": {
        "interaction_id": null,
        "experience_id": null,
        "originating_asset_alias": null,
        "olorin_tid": null,
        "agent": null,
        "additional_metadata": null,
        "supported_output_formats": null,
        "interaction_group_id": null
    },
    "agent_name": "Olorin.cas.hri.gaia:device-risk-analyzer",
    "session_id": null,
    "thread_id": "None-d3d28eaa-7ca9-4aa2-8905-69ac11fd8c58"
} with enable_langfuse=True
[32mINFO    [0m app.service.agent_service:agent_service.py:63 Invoking LangGraph with enable_langfuse=True
[31m[1mERROR   [0m app.service.agent_service:agent_service.py:89 Unknown Error: 'State' object has no attribute 'graph'
Traceback (most recent call last):
  File "/Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/starlette/datastructures.py", line 668, in __getattr__
    return self._state[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'graph'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/gklainert/Documents/gaia/app/service/agent_service.py", line 68, in ainvoke_agent
    result = await request.app.state.graph.ainvoke(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/starlette/datastructures.py", line 671, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'graph'
[31m[1mERROR   [0m app.router.device_router:device_router.py:465 LLM invocation or validation error for device risk for testuser: 'State' object has no attribute 'graph'
Traceback (most recent call last):
  File "/Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/starlette/datastructures.py", line 668, in __getattr__
    return self._state[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'graph'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/gklainert/Documents/gaia/app/service/agent_service.py", line 68, in ainvoke_agent
    result = await request.app.state.graph.ainvoke(
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/starlette/datastructures.py", line 671, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'graph'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/gklainert/Documents/gaia/app/router/device_router.py", line 439, in analyze_device
    raw_llm_response_str, _ = await ainvoke_agent(
                              ^^^^^^^^^^^^^^^^^^^^
  File "/Users/gklainert/Documents/gaia/app/service/agent_service.py", line 90, in ainvoke_agent
    raise AgentInvokeException(ex)
app.service.error_handling.AgentInvokeException: 'State' object has no attribute 'graph'
[31m[1mERROR   [0m app.router.api_router:api_router.py:716 Error in get_location_risk_analysis for user testuser: 'dict' object has no attribute 'raw_splunk_results'
Traceback (most recent call last):
  File "/Users/gklainert/Documents/gaia/app/router/api_router.py", line 597, in get_location_risk_analysis
    and processed_device_data.raw_splunk_results  # Access its raw_splunk_results
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute 'raw_splunk_results'
[31m[1m_________________________ test_connect_and_disconnect __________________________[0m

    [0m[37m@pytest[39;49;00m.mark.asyncio[90m[39;49;00m
    [94masync[39;49;00m [94mdef[39;49;00m[90m [39;49;00m[92mtest_connect_and_disconnect[39;49;00m():[90m[39;49;00m
        [94mwith[39;49;00m patch([33m"[39;49;00m[33msplunklib.client.connect[39;49;00m[33m"[39;49;00m, return_value=MagicMock()):[90m[39;49;00m
>           client = SplunkClient([33m"[39;49;00m[33mhost[39;49;00m[33m"[39;49;00m, [94m8089[39;49;00m, [33m"[39;49;00m[33muser[39;49;00m[33m"[39;49;00m, [33m"[39;49;00m[33mpw[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
[1m[31mE           TypeError: SplunkClient() takes no arguments[0m

[1m[31mapp/test/unit/service/agent/test_splunk_client.py[0m:55: TypeError
---------------------------- Captured stderr setup -----------------------------
[2025-06-01T17:05:27-0400] DEBUG [] module=selector_events: Using selector: KqueueSelector
------------------------------ Captured log setup ------------------------------
[35mDEBUG   [0m asyncio:selector_events.py:54 Using selector: KqueueSelector
[31m[1m_____________________________ test_search_success ______________________________[0m

    [0m[37m@pytest[39;49;00m.mark.asyncio[90m[39;49;00m
    [94masync[39;49;00m [94mdef[39;49;00m[90m [39;49;00m[92mtest_search_success[39;49;00m():[90m[39;49;00m
>       client = SplunkClient([33m"[39;49;00m[33mhost[39;49;00m[33m"[39;49;00m, [94m8089[39;49;00m, [33m"[39;49;00m[33muser[39;49;00m[33m"[39;49;00m, [33m"[39;49;00m[33mpw[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
[1m[31mE       TypeError: SplunkClient() takes no arguments[0m

[1m[31mapp/test/unit/service/agent/test_splunk_client.py[0m:64: TypeError
---------------------------- Captured stderr setup -----------------------------
[2025-06-01T17:05:27-0400] DEBUG [] module=selector_events: Using selector: KqueueSelector
------------------------------ Captured log setup ------------------------------
[35mDEBUG   [0m asyncio:selector_events.py:54 Using selector: KqueueSelector
[31m[1m____________________________ test_search_job_failed ____________________________[0m

    [0m[37m@pytest[39;49;00m.mark.asyncio[90m[39;49;00m
    [94masync[39;49;00m [94mdef[39;49;00m[90m [39;49;00m[92mtest_search_job_failed[39;49;00m():[90m[39;49;00m
>       client = SplunkClient([33m"[39;49;00m[33mhost[39;49;00m[33m"[39;49;00m, [94m8089[39;49;00m, [33m"[39;49;00m[33muser[39;49;00m[33m"[39;49;00m, [33m"[39;49;00m[33mpw[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
[1m[31mE       TypeError: SplunkClient() takes no arguments[0m

[1m[31mapp/test/unit/service/agent/test_splunk_client.py[0m:77: TypeError
---------------------------- Captured stderr setup -----------------------------
[2025-06-01T17:05:27-0400] DEBUG [] module=selector_events: Using selector: KqueueSelector
------------------------------ Captured log setup ------------------------------
[35mDEBUG   [0m asyncio:selector_events.py:54 Using selector: KqueueSelector
[31m[1m__________________________ test_search_not_connected ___________________________[0m

    [0m[37m@pytest[39;49;00m.mark.asyncio[90m[39;49;00m
    [94masync[39;49;00m [94mdef[39;49;00m[90m [39;49;00m[92mtest_search_not_connected[39;49;00m():[90m[39;49;00m
>       client = SplunkClient([33m"[39;49;00m[33mhost[39;49;00m[33m"[39;49;00m, [94m8089[39;49;00m, [33m"[39;49;00m[33muser[39;49;00m[33m"[39;49;00m, [33m"[39;49;00m[33mpw[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
[1m[31mE       TypeError: SplunkClient() takes no arguments[0m

[1m[31mapp/test/unit/service/agent/test_splunk_client.py[0m:89: TypeError
---------------------------- Captured stderr setup -----------------------------
[2025-06-01T17:05:27-0400] DEBUG [] module=selector_events: Using selector: KqueueSelector
------------------------------ Captured log setup ------------------------------
[35mDEBUG   [0m asyncio:selector_events.py:54 Using selector: KqueueSelector
[31m[1m___________________________ test_list_saved_searches ___________________________[0m

    [0m[37m@pytest[39;49;00m.mark.asyncio[90m[39;49;00m
    [94masync[39;49;00m [94mdef[39;49;00m[90m [39;49;00m[92mtest_list_saved_searches[39;49;00m():[90m[39;49;00m
>       client = SplunkClient([33m"[39;49;00m[33mhost[39;49;00m[33m"[39;49;00m, [94m8089[39;49;00m, [33m"[39;49;00m[33muser[39;49;00m[33m"[39;49;00m, [33m"[39;49;00m[33mpw[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
[1m[31mE       TypeError: SplunkClient() takes no arguments[0m

[1m[31mapp/test/unit/service/agent/test_splunk_client.py[0m:97: TypeError
---------------------------- Captured stderr setup -----------------------------
[2025-06-01T17:05:27-0400] DEBUG [] module=selector_events: Using selector: KqueueSelector
------------------------------ Captured log setup ------------------------------
[35mDEBUG   [0m asyncio:selector_events.py:54 Using selector: KqueueSelector
[31m[1m_____________________________ test_get_sourcetypes _____________________________[0m

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x194509e10>

    [0m[37m@pytest[39;49;00m.mark.asyncio[90m[39;49;00m
    [94masync[39;49;00m [94mdef[39;49;00m[90m [39;49;00m[92mtest_get_sourcetypes[39;49;00m(monkeypatch):[90m[39;49;00m
>       client = SplunkClient([33m"[39;49;00m[33mhost[39;49;00m[33m"[39;49;00m, [94m8089[39;49;00m, [33m"[39;49;00m[33muser[39;49;00m[33m"[39;49;00m, [33m"[39;49;00m[33mpw[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
[1m[31mE       TypeError: SplunkClient() takes no arguments[0m

[1m[31mapp/test/unit/service/agent/test_splunk_client.py[0m:109: TypeError
---------------------------- Captured stderr setup -----------------------------
[2025-06-01T17:05:27-0400] DEBUG [] module=selector_events: Using selector: KqueueSelector
------------------------------ Captured log setup ------------------------------
[35mDEBUG   [0m asyncio:selector_events.py:54 Using selector: KqueueSelector
[31m[1m____________________________ test_get_field_summary ____________________________[0m

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x194293b10>

    [0m[37m@pytest[39;49;00m.mark.asyncio[90m[39;49;00m
    [94masync[39;49;00m [94mdef[39;49;00m[90m [39;49;00m[92mtest_get_field_summary[39;49;00m(monkeypatch):[90m[39;49;00m
>       client = SplunkClient([33m"[39;49;00m[33mhost[39;49;00m[33m"[39;49;00m, [94m8089[39;49;00m, [33m"[39;49;00m[33muser[39;49;00m[33m"[39;49;00m, [33m"[39;49;00m[33mpw[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
[1m[31mE       TypeError: SplunkClient() takes no arguments[0m

[1m[31mapp/test/unit/service/agent/test_splunk_client.py[0m:119: TypeError
---------------------------- Captured stderr setup -----------------------------
[2025-06-01T17:05:27-0400] DEBUG [] module=selector_events: Using selector: KqueueSelector
------------------------------ Captured log setup ------------------------------
[35mDEBUG   [0m asyncio:selector_events.py:54 Using selector: KqueueSelector
[31m[1m_____________________________ test_run_stats_query _____________________________[0m

monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x1943dc450>

    [0m[37m@pytest[39;49;00m.mark.asyncio[90m[39;49;00m
    [94masync[39;49;00m [94mdef[39;49;00m[90m [39;49;00m[92mtest_run_stats_query[39;49;00m(monkeypatch):[90m[39;49;00m
>       client = SplunkClient([33m"[39;49;00m[33mhost[39;49;00m[33m"[39;49;00m, [94m8089[39;49;00m, [33m"[39;49;00m[33muser[39;49;00m[33m"[39;49;00m, [33m"[39;49;00m[33mpw[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
[1m[31mE       TypeError: SplunkClient() takes no arguments[0m

[1m[31mapp/test/unit/service/agent/test_splunk_client.py[0m:129: TypeError
---------------------------- Captured stderr setup -----------------------------
[2025-06-01T17:05:27-0400] DEBUG [] module=selector_events: Using selector: KqueueSelector
------------------------------ Captured log setup ------------------------------
[35mDEBUG   [0m asyncio:selector_events.py:54 Using selector: KqueueSelector
[31m[1m____________________________ test_run_query_success ____________________________[0m

    [0m[94mdef[39;49;00m[90m [39;49;00m[92mtest_run_query_success[39;49;00m():[90m[39;49;00m
>       client = SplunkClient([33m"[39;49;00m[33mhost[39;49;00m[33m"[39;49;00m, [94m8089[39;49;00m, [33m"[39;49;00m[33muser[39;49;00m[33m"[39;49;00m, [33m"[39;49;00m[33mpw[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
[1m[31mE       TypeError: SplunkClient() takes no arguments[0m

[1m[31mapp/test/unit/service/agent/test_splunk_client.py[0m:138: TypeError
[31m[1m_________________________ test_run_query_not_connected _________________________[0m

    [0m[94mdef[39;49;00m[90m [39;49;00m[92mtest_run_query_not_connected[39;49;00m():[90m[39;49;00m
>       client = SplunkClient([33m"[39;49;00m[33mhost[39;49;00m[33m"[39;49;00m, [94m8089[39;49;00m, [33m"[39;49;00m[33muser[39;49;00m[33m"[39;49;00m, [33m"[39;49;00m[33mpw[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
[1m[31mE       TypeError: SplunkClient() takes no arguments[0m

[1m[31mapp/test/unit/service/agent/test_splunk_client.py[0m:152: TypeError
[31m[1m______________________________ test_is_connected _______________________________[0m

    [0m[94mdef[39;49;00m[90m [39;49;00m[92mtest_is_connected[39;49;00m():[90m[39;49;00m
>       client = SplunkClient([33m"[39;49;00m[33mhost[39;49;00m[33m"[39;49;00m, [94m8089[39;49;00m, [33m"[39;49;00m[33muser[39;49;00m[33m"[39;49;00m, [33m"[39;49;00m[33mpw[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
[1m[31mE       TypeError: SplunkClient() takes no arguments[0m

[1m[31mapp/test/unit/service/agent/test_splunk_client.py[0m:159: TypeError
[33m=============================== warnings summary ===============================[0m
../../Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/_pytest/config/__init__.py:1500
  /Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/_pytest/config/__init__.py:1500: PytestConfigWarning: No files were found in testpaths; consider removing or adjusting your testpaths configuration. Searching recursively from the current directory instead.
    self.args, self.args_source = self._decide_args(

../../Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/_pytest/assertion/rewrite.py:185
  /Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/_pytest/assertion/rewrite.py:185: UserWarning: WARNING! response_format is not default parameter.
                  response_format was transferred to model_kwargs.
                  Please confirm that response_format is what you intended.
    exec(co, module.__dict__)

app/test/adapters/test_upi_client.py::test_final_interactions_empty_on_exception
  /Users/gklainert/Documents/gaia/app/adapters/upi_client.py:82: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    response.raise_for_status()
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

app/test/integration/test_auth.py: 3 warnings
app/test/integration/test_endpoints.py: 19 warnings
  /Users/gklainert/Library/Caches/pypoetry/virtualenvs/gaia-xi6LH7pC-py3.11/lib/python3.11/site-packages/starlette/routing.py:616: DeprecationWarning: async generator function lifespans are deprecated, use an @contextlib.asynccontextmanager function instead
    warnings.warn(

app/test/unit/persistence/test_async_ips_redis.py::test_make_writes_zset_name
  app/test/unit/persistence/test_async_ips_redis.py:196: PytestWarning: The test <Function test_make_writes_zset_name> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/persistence/test_async_ips_redis.py::test_make_redis_writes_key
  app/test/unit/persistence/test_async_ips_redis.py:204: PytestWarning: The test <Function test_make_redis_writes_key> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/persistence/test_async_ips_redis.py::test_parse_redis_checkpoint_writes_key
  app/test/unit/persistence/test_async_ips_redis.py:212: PytestWarning: The test <Function test_parse_redis_checkpoint_writes_key> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/persistence/test_async_ips_redis.py::test_decode_if_bytes
  app/test/unit/persistence/test_async_ips_redis.py:225: PytestWarning: The test <Function test_decode_if_bytes> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/persistence/test_async_ips_redis.py::test_filter_keys
  app/test/unit/persistence/test_async_ips_redis.py:233: PytestWarning: The test <Function test_filter_keys> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_kk_dash_client.py::test_connect_and_disconnect
  app/test/unit/service/agent/test_kk_dash_client.py:37: PytestWarning: The test <Function test_connect_and_disconnect> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_kk_dash_client.py::test_get_current_network_data_success
  app/test/unit/service/agent/test_kk_dash_client.py:43: PytestWarning: The test <Function test_get_current_network_data_success> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_kk_dash_client.py::test_get_current_network_data_empty
  app/test/unit/service/agent/test_kk_dash_client.py:56: PytestWarning: The test <Function test_get_current_network_data_empty> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_kk_dash_client.py::test_get_current_network_data_error
  app/test/unit/service/agent/test_kk_dash_client.py:65: PytestWarning: The test <Function test_get_current_network_data_error> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_kk_dash_client.py::test_get_user_events
  app/test/unit/service/agent/test_kk_dash_client.py:77: PytestWarning: The test <Function test_get_user_events> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_kk_dash_client.py::test_get_device_info
  app/test/unit/service/agent/test_kk_dash_client.py:84: PytestWarning: The test <Function test_get_device_info> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_kk_dash_client.py::test_get_login_data
  app/test/unit/service/agent/test_kk_dash_client.py:91: PytestWarning: The test <Function test_get_login_data> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_splunk_agent.py::test_create_timechart
  app/test/unit/service/agent/test_splunk_agent.py:56: PytestWarning: The test <Function test_create_timechart> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_splunk_agent.py::test_get_sourcetypes
  app/test/unit/service/agent/test_splunk_agent.py:77: PytestWarning: The test <Function test_get_sourcetypes> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_splunk_agent.py::test_get_field_summary
  app/test/unit/service/agent/test_splunk_agent.py:89: PytestWarning: The test <Function test_get_field_summary> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_splunk_agent.py::test_get_saved_searches
  app/test/unit/service/agent/test_splunk_agent.py:101: PytestWarning: The test <Function test_get_saved_searches> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_splunk_agent.py::test_run_stats_query
  app/test/unit/service/agent/test_splunk_agent.py:113: PytestWarning: The test <Function test_run_stats_query> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_splunk_agent.py::test_connect_and_disconnect
  app/test/unit/service/agent/test_splunk_agent.py:122: PytestWarning: The test <Function test_connect_and_disconnect> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_splunk_client.py::test_get_login_history
  app/test/unit/service/agent/test_splunk_client.py:20: PytestWarning: The test <Function test_get_login_history> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_splunk_client.py::test_get_error_events
  app/test/unit/service/agent/test_splunk_client.py:27: PytestWarning: The test <Function test_get_error_events> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_splunk_client.py::test_get_device_history
  app/test/unit/service/agent/test_splunk_client.py:34: PytestWarning: The test <Function test_get_device_history> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_splunk_client.py::test_get_user_history
  app/test/unit/service/agent/test_splunk_client.py:43: PytestWarning: The test <Function test_get_user_history> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_tmx_client.py::test_connect_and_disconnect
  app/test/unit/service/agent/test_tmx_client.py:14: PytestWarning: The test <Function test_connect_and_disconnect> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_tmx_client.py::test_get_network_analysis
  app/test/unit/service/agent/test_tmx_client.py:20: PytestWarning: The test <Function test_get_network_analysis> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_tmx_client.py::test_get_device_analysis
  app/test/unit/service/agent/test_tmx_client.py:27: PytestWarning: The test <Function test_get_device_analysis> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/agent/test_tmx_client.py::test_get_device_info
  app/test/unit/service/agent/test_tmx_client.py:34: PytestWarning: The test <Function test_get_device_info> is marked with '@pytest.mark.asyncio' but it is not an async function. Please remove the asyncio mark. If the test is not marked explicitly, check for global marks applied via 'pytestmark'.
    @pytest.mark.asyncio

app/test/unit/service/test_agent_service.py::test_ainvoke_agent_rate_limit_error
  /usr/local/Cellar/python@3.11/3.11.12_1/Frameworks/Python.framework/Versions/3.11/lib/python3.11/unittest/mock.py:2178: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    def __init__(self, name, parent):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_location_client_vector_search.py::test_vector_search_integration
  /Users/gklainert/Documents/gaia/app/service/agent/ato_agents/location_data_agent/client.py:327: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    display_address.dict()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
______________ coverage: platform darwin, python 3.11.12-final-0 _______________

Name                                                                           Stmts   Miss  Cover   Missing
------------------------------------------------------------------------------------------------------------
app/__init__.py                                                                    0      0   100%
app/adapters/__init__.py                                                           0      0   100%
app/adapters/ips_cache_client.py                                                  63     47    25%   15, 22, 33-63, 68-69, 76, 90, 100-101, 112-122, 129-138
app/adapters/upi_client.py                                                        82      0   100%
app/models/__init__.py                                                             0      0   100%
app/models/agent_context.py                                                       40     10    75%   43, 66-90
app/models/agent_headers.py                                                       13      1    92%   19
app/models/agent_request.py                                                       35      0   100%
app/models/agent_response.py                                                      19      1    95%   41
app/models/api_models.py                                                          56      0   100%
app/models/comment_message.py                                                     10      0   100%
app/models/device_risk.py                                                         27      0   100%
app/models/location_risk.py                                                       13      0   100%
app/models/network_risk.py                                                        23      0   100%
app/models/oii_response.py                                                       119      0   100%
app/models/upi_response.py                                                        50      0   100%
app/persistence/__init__.py                                                       62      8    87%   30, 65, 86-87, 105, 107, 112-113
app/persistence/async_ips_redis.py                                               212     50    76%   132, 149, 202-203, 222-232, 243, 299-302, 453, 467, 504-526, 554-585, 603-621, 631
app/router/__init__.py                                                             0      0   100%
app/router/agent_router.py                                                        33      9    73%   44-52
app/router/agent_router_helper.py                                                 20      0   100%
app/router/api_router.py                                                         287     54    81%   142, 157-158, 162, 170-171, 176, 199, 203, 212, 228-229, 291, 323, 338, 349-368, 527, 533, 599-704, 746
app/router/comment_router.py                                                      20     10    50%   24-29, 41-49
app/router/demo_router.py                                                         27      6    78%   24, 32-33, 38-42
app/router/device_router.py                                                      330     66    80%   113-114, 167-168, 199, 202-204, 232, 305-308, 322-337, 353-362, 377-379, 389-392, 405, 450-454, 472-474, 476-478, 482-484, 502, 504, 508-509, 513-514, 517-518, 535-539, 578, 670-674, 695-696
app/router/investigations_router.py                                               46     10    78%   28-29, 40-49, 59, 74, 80-81
app/router/location_router.py                                                    252     82    67%   42, 46, 71-72, 103-155, 234-238, 246-247, 249-250, 284, 333, 339-342, 350-353, 370-371, 373-374, 376-377, 386-406, 451-453, 458-477, 479, 492, 494, 499, 502, 506-514
app/router/logs_router.py                                                        157     80    49%   39-50, 78, 115-121, 133, 183, 208-365
app/router/network_router.py                                                     203    114    44%   67, 75-76, 108-114, 128-129, 134-140, 149-155, 166-168, 174-182, 203-216, 233-252, 266, 295-450
app/router/risk_assessment_router.py                                              57     17    70%   24, 107-112, 121-173
app/service/__init__.py                                                           92     15    84%   11-16, 106, 125-127, 155-157, 175, 183, 223, 231, 235
app/service/agent/agent.py                                                       102     27    74%   73-74, 78-98, 169-184, 196
app/service/agent/ato_agents/__init__.py                                           1      0   100%
app/service/agent/ato_agents/clients/__init__.py                                   4      0   100%
app/service/agent/ato_agents/clients/kk_dash_client.py                            34      1    97%   52
app/service/agent/ato_agents/clients/splunk_client.py                             15      2    87%   12, 16
app/service/agent/ato_agents/clients/tmx_client.py                                12      0   100%
app/service/agent/ato_agents/interfaces.py                                       106     20    81%   64, 66, 68, 70, 72, 81, 86, 95, 102, 107, 116, 123, 128, 137, 144, 149, 158, 163, 170, 177
app/service/agent/ato_agents/location_data_agent/__init__.py                       9      2    78%   17-18
app/service/agent/ato_agents/location_data_agent/agent.py                        215     66    69%   110-112, 121-123, 224, 234-236, 264-265, 267-268, 285-287, 294-313, 320-347, 354-368, 388-397, 406-408
app/service/agent/ato_agents/location_data_agent/client.py                       275     46    83%   214, 333-334, 342-343, 351-352, 359-360, 367-368, 431-436, 446-448, 484-487, 499, 611, 623, 635, 646, 655, 664, 672-697, 718-722, 742, 749, 753, 765, 769
app/service/agent/ato_agents/splunk_agent/__init__.py                              3      0   100%
app/service/agent/ato_agents/splunk_agent/agent.py                                79     37    53%   45-47, 72-74, 105-107, 122-127, 142-147, 155-157, 172-180, 223-227, 232, 236, 251-253
app/service/agent/ato_agents/splunk_agent/ato_splunk_query_constructor.py         35      5    86%   38-56, 126-127
app/service/agent/ato_agents/splunk_agent/client.py                              143     90    37%   49-95, 99-115, 141, 150, 160-190, 207-246, 268-287
app/service/agent/ato_agents/splunk_agent/fraud_response.py                       19      0   100%
app/service/agent/ato_agents/splunk_agent/user_analysis_query_constructor.py      44     24    45%   21-47, 52-66, 71-77, 93, 134, 162, 180, 202, 216, 249-255, 276-282, 297, 318
app/service/agent/ato_agents/utils/logging.py                                     21      3    86%   27-29
app/service/agent/tools/cdc_tool/cdc_tool.py                                      73      0   100%
app/service/agent/tools/cdc_tool/cdc_trusted_attributes.py                         2      0   100%
app/service/agent/tools/chronos_tool/__init__.py                                   0      0   100%
app/service/agent/tools/chronos_tool/chronos_tool.py                             102     27    74%   44-48, 69-71, 93-94, 158-161, 169-170, 174-179, 203-206, 217-220, 231-233
app/service/agent/tools/di_tool/di_tool.py                                        44      2    95%   79-80
app/service/agent/tools/oii_tool/__init__.py                                       0      0   100%
app/service/agent/tools/oii_tool/oii_tool.py                                      44      6    86%   53-55, 96-99
app/service/agent/tools/qb_tool/__init__.py                                        0      0   100%
app/service/agent/tools/qb_tool/customer_tools.py                                 50      0   100%
app/service/agent/tools/qb_tool/payload_get_customer.py                            1      0   100%
app/service/agent/tools/qb_tool/payload_get_customers.py                           1      0   100%
app/service/agent/tools/qb_tool/qbo_service.py                                    63      0   100%
app/service/agent/tools/retriever_tool/retriever_tool.py                         106     38    64%   22-34, 39-52, 121-124, 134, 138, 171-203, 226, 244, 249
app/service/agent/tools/splunk_tool/__init__.py                                    2      0   100%
app/service/agent/tools/splunk_tool/splunk_tool.py                                34      6    82%   39-41, 57-58, 65-66
app/service/agent/tools/vector_search_tool/__init__.py                             2      0   100%
app/service/agent/tools/vector_search_tool/vector_search_tool.py                 107     11    90%   85-86, 237-239, 262-263, 314-315, 453-454
app/service/agent_service.py                                                      48      2    96%   52-53
app/service/auth.py                                                               17      1    94%   32
app/service/config.py                                                             91      0   100%
app/service/error_handling.py                                                     36      8    78%   5-10, 57-58, 65-66
app/service/example.py                                                            12      2    83%   45-46
app/service/logging_helper.py                                                     20      0   100%
app/utils/__init__.py                                                              0      0   100%
app/utils/auth_utils.py                                                           82      0   100%
app/utils/class_utils.py                                                          12      0   100%
app/utils/constants.py                                                             2      0   100%
app/utils/idps_utils.py                                                           14      0   100%
app/utils/prompt_utils.py                                                         31      3    90%   8-12
app/utils/prompts.py                                                               4      0   100%
conftest.py                                                                       63     28    56%   18-20, 27-29, 40, 49-53, 59-65, 78, 108-111, 117-128, 134
tests/test_investigation_workflow.py                                             173     13    92%   27-28, 83-84, 100, 214, 219, 338, 386-390
tests/test_location_api_integration.py                                           152     79    48%   134-138, 149-151, 194-196, 214-288, 309-316, 321-364, 369-374, 378-379
tests/test_location_client_vector_search.py                                      120     19    84%   269-284, 314-316, 377-392, 396-397
tests/test_pdf_generation.py                                                     143    135     6%   21-294, 299-330, 334-335
tests/test_vector_search_simple.py                                               130     25    81%   295-296, 349, 353, 356, 359, 373-400, 404-405
------------------------------------------------------------------------------------------------------------
TOTAL                                                                           5246   1308    75%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage/coverage.xml
[36m[1m=========================== short test summary info ============================[0m
[31mFAILED[0m app/test/unit/router/test_agent_router.py::[1mtest_get_location_risk_analysis_success[0m - assert 500 == 200
[31mFAILED[0m app/test/unit/service/agent/test_splunk_client.py::[1mtest_connect_and_disconnect[0m - TypeError: SplunkClient() takes no arguments
[31mFAILED[0m app/test/unit/service/agent/test_splunk_client.py::[1mtest_search_success[0m - TypeError: SplunkClient() takes no arguments
[31mFAILED[0m app/test/unit/service/agent/test_splunk_client.py::[1mtest_search_job_failed[0m - TypeError: SplunkClient() takes no arguments
[31mFAILED[0m app/test/unit/service/agent/test_splunk_client.py::[1mtest_search_not_connected[0m - TypeError: SplunkClient() takes no arguments
[31mFAILED[0m app/test/unit/service/agent/test_splunk_client.py::[1mtest_list_saved_searches[0m - TypeError: SplunkClient() takes no arguments
[31mFAILED[0m app/test/unit/service/agent/test_splunk_client.py::[1mtest_get_sourcetypes[0m - TypeError: SplunkClient() takes no arguments
[31mFAILED[0m app/test/unit/service/agent/test_splunk_client.py::[1mtest_get_field_summary[0m - TypeError: SplunkClient() takes no arguments
[31mFAILED[0m app/test/unit/service/agent/test_splunk_client.py::[1mtest_run_stats_query[0m - TypeError: SplunkClient() takes no arguments
[31mFAILED[0m app/test/unit/service/agent/test_splunk_client.py::[1mtest_run_query_success[0m - TypeError: SplunkClient() takes no arguments
[31mFAILED[0m app/test/unit/service/agent/test_splunk_client.py::[1mtest_run_query_not_connected[0m - TypeError: SplunkClient() takes no arguments
[31mFAILED[0m app/test/unit/service/agent/test_splunk_client.py::[1mtest_is_connected[0m - TypeError: SplunkClient() takes no arguments
[31m====== [31m[1m12 failed[0m, [32m316 passed[0m, [33m1 skipped[0m, [33m53 warnings[0m[31m in 150.92s (0:02:30)[0m[31m ======[0m
