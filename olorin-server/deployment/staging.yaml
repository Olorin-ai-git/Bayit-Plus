# Olorin Backend - Staging Environment Configuration
# Google Cloud Run deployment configuration for staging environment

# Environment Variables for Staging
env_vars:
  APP_ENV: "stg"
  FIREBASE_PROJECT_ID: "olorin-ai-staging"
  LOG_LEVEL: "DEBUG"
  PYTHONPATH: "/app"
  CORS_ORIGINS: "https://staging.olorin-ai.web.app,https://olorin-ai-staging.web.app"
  
  # Database Configuration
  DB_HOST: "localhost"
  DB_PORT: "3306"
  DB_NAME: "fraud_detection_staging"
  DB_USER: "olorin_user"
  DB_POOL_SIZE: "5"
  
  # Redis Configuration  
  REDIS_HOST: "redis-staging.c253.us-central1-1.gce.redns.redis-cloud.com"
  REDIS_PORT: "13848"
  REDIS_USERNAME: "default"
  REDIS_DB: "1"
  REDIS_POOL_SIZE: "5"
  
  # JWT Configuration
  JWT_ALGORITHM: "HS256"
  JWT_EXPIRE_HOURS: "1"
  
  # Rate Limiting
  RATE_LIMIT_REQUESTS: "500"
  RATE_LIMIT_WINDOW: "3600"
  
  # MCP Server Configuration
  MCP_SERVER_HOST: "0.0.0.0"
  MCP_SERVER_PORT: "8091"

# Cloud Run Service Configuration
service:
  name: "olorin-backend-staging"
  region: "us-central1"
  
  # Resource Allocation
  memory: "2Gi"
  cpu: "1"
  
  # Scaling Configuration
  min_instances: 0
  max_instances: 10
  
  # Timeout and Concurrency
  timeout: 300
  concurrency: 50
  
  # Service Account
  service_account: "olorin-backend-staging@olorin-ai.iam.gserviceaccount.com"
  
  # Traffic Configuration
  allow_unauthenticated: true
  
  # Execution Environment
  execution_environment: "gen2"
  cpu_throttling: true

# Secrets Configuration (Firebase Secrets Manager)
secrets:
  - name: "ANTHROPIC_API_KEY"
    version: "latest"
  - name: "OPENAI_API_KEY" 
    version: "latest"
  - name: "DATABASE_PASSWORD"
    version: "latest"
  - name: "REDIS_PASSWORD"
    version: "latest"
  - name: "REDIS_API_KEY"
    version: "latest"
  - name: "JWT_SECRET_KEY"
    version: "latest"
  - name: "SPLUNK_USERNAME"
    version: "latest"
  - name: "SPLUNK_PASSWORD"
    version: "latest"
  - name: "OLORIN_API_KEY"
    version: "latest"
  - name: "ABUSEIPDB_API_KEY"
    version: "latest"

# Health Check Configuration
health_check:
  path: "/health"
  interval: 30
  timeout: 10
  retries: 3
  start_period: 60

# Build Configuration
build:
  dockerfile: "Dockerfile"
  args:
    APP_ENV: "staging"
    WORKERS: "1"
    PYTHON_VERSION: "3.11"
    POETRY_VERSION: "1.8.0"

# Monitoring and Logging
monitoring:
  enable_cloud_monitoring: true
  enable_cloud_logging: true
  log_level: "DEBUG"
  
# IAM Configuration
iam:
  roles:
    - "roles/secretmanager.secretAccessor"
    - "roles/cloudsql.client"
    - "roles/logging.logWriter"
    - "roles/monitoring.metricWriter"