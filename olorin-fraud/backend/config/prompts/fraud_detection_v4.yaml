# Fraud Detection Prompt Templates v4
# Feature: 026-llm-training-pipeline
# PROPER ML EVALUATION: Uses behavioral features only - NO label leakage

version: v4
created_at: "2024-12-10"
description: "Predictive fraud detection using behavioral features only (no label leakage)"

# System prompt - predictive approach (no fraud history available)
system_prompt: |
  You are an expert fraud detection analyst evaluating entities for FUTURE fraud risk.

  IMPORTANT: You are predicting which entities WILL commit fraud, not identifying
  entities that HAVE committed fraud. You have NO information about past fraud
  - only behavioral patterns from their transaction history.

  You must provide:
  1. A risk score between 0.0 (low risk) and 1.0 (high risk)
  2. A confidence level between 0.0 (uncertain) and 1.0 (certain)
  3. A prediction: FRAUD or LEGITIMATE
  4. Brief reasoning explaining your assessment

  ## Behavioral Risk Indicators (What You CAN Use)

  ### High-Risk Behavioral Patterns:
  - Multiple devices (>3) for single email -> elevated risk
  - Multiple IP addresses (>5) for single email -> elevated risk
  - High transaction velocity (many txs in short period) -> elevated risk
  - Very high average transaction value -> elevated risk
  - High transaction value variance (std_tx_value high) -> elevated risk
  - Activity across multiple merchants -> contextual (could be normal)

  ### Low-Risk Behavioral Patterns:
  - Single device, single IP -> lower risk
  - Consistent transaction values -> lower risk
  - Moderate transaction frequency -> lower risk
  - Long account history with stable patterns -> lower risk

  ## Scoring Guidelines

  Without fraud history, you must rely on behavioral anomalies:
  - device_count > 3 AND ip_count > 5 -> risk_score >= 0.6
  - Very high variance in transaction values -> risk_score += 0.15
  - High transaction count with high GMV -> risk_score += 0.1
  - Normal behavioral patterns -> risk_score 0.2-0.4

  ## Decision Threshold
  - risk_score >= 0.55 -> predict FRAUD
  - risk_score < 0.55 -> predict LEGITIMATE

  NOTE: This is a HARD problem. Without fraud history, accuracy will be lower
  than with perfect information. That's expected and realistic.

# Main fraud analysis prompt - v4 (no fraud history features)
fraud_analysis_prompt: |
  Predict future fraud risk for the following entity using behavioral patterns.

  ## Entity Information
  - Entity Type: {entity_type}
  - Entity Value: {entity_value}
  - Merchant: {merchant_name}

  ## Transaction Summary (Feature Period)
  - Total Transactions: {total_transactions}
  - Total GMV: ${total_gmv}
  - Average Transaction Value: ${avg_tx_value}
  - Transaction Value Std Dev: ${std_tx_value}
  - Date Range: {date_range}

  ## Device & Network Patterns
  - Unique Devices: {unique_devices}
  - Unique IPs: {unique_ips}
  - Unique Merchants: {unique_merchants}

  ## Risk Assessment Guidelines:
  1. Multiple devices/IPs for single email = suspicious behavior
  2. High value variance = potentially testing card limits
  3. Activity across many merchants = could be fraudster probing
  4. Very high average transaction value = elevated risk
  5. Stable, consistent patterns = lower risk

  IMPORTANT: You do NOT have fraud history information. Base your prediction
  on behavioral patterns that correlate with future fraud.

  Provide your fraud prediction in the following JSON format:
  ```json
  {{
    "risk_score": <float 0.0-1.0>,
    "confidence": <float 0.0-1.0>,
    "prediction": "<FRAUD|LEGITIMATE>",
    "reasoning": "<brief explanation>",
    "key_indicators": [<list of behavioral indicators found>],
    "risk_factors": {{
      "device_risk": <float 0.0-1.0>,
      "velocity_risk": <float 0.0-1.0>,
      "value_risk": <float 0.0-1.0>,
      "pattern_risk": <float 0.0-1.0>
    }}
  }}
  ```

# Template for fraud indicators - v4: BEHAVIORAL ONLY (no fraud_tx_count!)
# NOTE: fraud_tx_count would be label leakage - we use behavioral proxies instead
fraud_indicators_template: |
  ## Behavioral Risk Indicators (No fraud history available)
  - Total Transactions: {total_transactions}
  - Total GMV: ${total_gmv}
  - Average Transaction Value: ${avg_tx_value}
  - Transaction Value Std Dev: ${std_tx_value}
  - Unique Devices: {device_count}
  - Unique IPs: {ip_count}
  - Unique Merchants: {merchant_count}

# Template for velocity analysis - v4: Transaction patterns only
velocity_analysis_template: |
  ## Transaction Velocity Patterns
  - Transaction Count: {total_transactions}
  - Average Transaction Value: ${avg_tx_value}
  - Value Variance (Std Dev): ${std_tx_value}
  - Activity Span: {first_tx_date} to {last_tx_date}

# Template for geographic analysis - v4: IP diversity only (no country data)
geographic_analysis_template: |
  ## Network Diversity
  - Unique IP Addresses: {ip_count}
  - IP per Transaction Ratio: {ip_ratio}

# Template for device/network analysis
device_analysis_template: |
  ## Device Fingerprint Analysis
  - Unique Devices: {device_count}
  - Unique IPs: {ip_count}
  - Multi-Device Pattern: {multi_device}

# Template for historical patterns - v4: No fraud history, just account age
historical_patterns_template: |
  ## Account History
  - First Transaction: {first_tx_date}
  - Last Transaction: {last_tx_date}
  - Transaction Count: {total_transactions}
  - Merchants Used: {merchant_count}

# Batch analysis prompt for multiple entities
batch_analysis_prompt: |
  Predict future fraud risk for the following batch of {entity_count} entities.
  Use behavioral patterns only - you do NOT have fraud history information.

  {entities_data}

  Provide your analysis as a JSON array with one object per entity:
  ```json
  [
    {{
      "entity_id": "<entity identifier>",
      "risk_score": <float 0.0-1.0>,
      "confidence": <float 0.0-1.0>,
      "prediction": "<FRAUD|LEGITIMATE>",
      "reasoning": "<brief explanation>"
    }}
  ]
  ```

# Feedback analysis prompt for misclassifications
feedback_analysis_prompt: |
  The following prediction was incorrect:

  ## Original Prediction
  - Entity: {entity_value}
  - Predicted: {predicted_label}
  - Actual: {actual_label}
  - Risk Score: {risk_score}

  ## Entity Behavioral Data (Feature Period)
  {entity_data}

  ## Actual Outcome (Observation Period)
  - Committed Fraud: {committed_fraud}

  Analyze why this prediction was incorrect:
  ```json
  {{
    "error_type": "<false_positive|false_negative>",
    "likely_cause": "<explanation>",
    "missed_patterns": [<list of patterns that should have been weighted differently>],
    "suggested_adjustments": {{
      "behavioral_weights": {{<suggested weight adjustments>}},
      "threshold_adjustment": <suggested threshold change>
    }}
  }}
  ```
